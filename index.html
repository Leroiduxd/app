<!DOCTYPE html>
<html data-wf-page="67e1f6e85a9334351f521c30" data-wf-site="67e1f6e85a9334351f521c22" data-wf-status="1" lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Brokex Protocol</title>
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <meta content="Webflow" name="generator" />
    <link href="css/webflow-style.css" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous" />
    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
    <script src="https://unpkg.com/lightweight-charts@3.8.0/dist/lightweight-charts.standalone.production.js"></script>

    <script type="text/javascript">
      WebFont.load({
        google: {
          families: ["Source Code Pro:300,regular,500,600,700"]
        }
      });
    </script>
    <script type="text/javascript">
      ! function(o, c) {
        var n = c.documentElement,
          t = " w-mod-";
        n.className += t + "js", ("ontouchstart" in o || o.DocumentTouch && c instanceof DocumentTouch) && (n.className += t + "touch")
      }(window, document);
    </script>
    <link href="https://cdn.prod.website-files.com/67e1f6e85a9334351f521c22/67e1f77f6b5f1e5542cc54e1_Frame%205.svg" rel="shortcut icon" type="image/x-icon" />
    <link href="https://cdn.prod.website-files.com/67e1f6e85a9334351f521c22/67e1f7835a9334351f529edf_Frame%201%20(1).png" rel="apple-touch-icon" />
  </head>
  <body class="body">
    <div id="notification"></div>

    <section class="section">
      <div class="div-block-541">
        <div class="div-block-531">
          <div class="div-block-532"></div>
          <div class="div-block-533">
            <div class="div-block-534">
              <div class="div-block-535">
                <img src="https://cdn.prod.website-files.com/67e1f6e85a9334351f521c22/67e1f7835a9334351f529edf_Frame%201%20(1).png" loading="lazy" alt="" class="image-20" />
                <img src="https://cdn.prod.website-files.com/67e1f6e85a9334351f521c22/67e1f86d00f8d15dc4f693f3_Frame%204.svg" loading="lazy" alt="" class="image-21" />
                <a data-w-id="3597f163-8009-288b-19e6-e36c6d8fa206" href="#" class="button-116 w-button">Close X</a>
              </div>
              <div id="w-node-_2cbf834b-962e-518d-940d-80a39367165d-1f521c30" class="div-block-536">
                <div class="div-block-537">
                  <div>Your Actual E-mail : </div>
                  <div class="text-block-269">no email set</div>
                </div>
                <div class="div-block-538">
                  <div class="w-form">
                    <form id="email-form-7" name="email-form-7" data-name="Email Form 7" method="get" class="form-5" data-wf-page-id="67e1f6e85a9334351f521c30" data-wf-element-id="fd3221bd-ac09-eb76-a945-026034984262" data-turnstile-sitekey="0x4AAAAAAAQTptj2So4dx43e">
                      <input class="text-field-19 w-input" maxlength="256" name="name-3" data-name="Name 3" placeholder="contact@brokex.trade" type="email" id="name-3" />
                      <a href="#" class="button-117 w-button">Confirm email</a>
                    </form>
                    <div class="w-form-done">
                      <div>Thank you! Your submission has been received!</div>
                    </div>
                    <div class="w-form-fail">
                      <div>Oops! Something went wrong while submitting the form.</div>
                    </div>
                  </div>
                </div>
                <div class="div-block-542">
                  <div class="div-block-539">
                    <div class="text-block-270">Enable/Disable e-mail notification : </div>
                    <a href="#" class="button-118 w-button">Disable</a>
                  </div>
                  <div class="div-block-539">
                    <div class="text-block-270">Delete your e-mail : </div>
                    <a href="#" class="button-118 w-button">Delete</a>
                  </div>
                </div>
                <div class="div-block-540"></div>
                <div class="text-block-271">Your data is not stored in a traditional database but within a smart contract. Only you and the Brokex developer can access it. You may delete it at any time.</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <div class="div-block">
      <div>
        <div class="div-block-447">
          <div class="div-block-448">
            <div class="div-block-449">
              <a href="http://brokex.trade" class="linksite w-inline-block">
                <div class="div-block-450">
                  <img data-w-id="9e9a951c-2bf3-a1dc-cc56-6a6ed1b5d057" loading="lazy" alt="" src="https://cdn.prod.website-files.com/66ec96ee52e0da07590152af/67b525dbdf8b027a799bdfd5_Frame%202.svg" />
                  <img loading="lazy" src="https://cdn.prod.website-files.com/67e1f6e85a9334351f521c22/67e1f86d00f8d15dc4f693f3_Frame%204.svg" alt="" class="image-19" />
                </div>
              </a>
              <div class="div-block-451">
                <div class="div-block-453"></div>
                <a href="#" data-w-id="f1a21736-2746-bf4f-0756-42659b8440ad" class="link-block-16 w-inline-block">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" app="ikonik" class="ikonik-ebjtuh">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M11.9426 1.25C9.63423 1.24999 7.82519 1.24998 6.41371 1.43975C4.96897 1.63399 3.82895 2.03933 2.93414 2.93414C2.03933 3.82895 1.63399 4.96897 1.43975 6.41371C1.24998 7.82519 1.24999 9.63423 1.25 11.9426V12.0574C1.24999 14.3658 1.24998 16.1748 1.43975 17.5863C1.63399 19.031 2.03933 20.1711 2.93414 21.0659C3.82895 21.9607 4.96897 22.366 6.41371 22.5603C7.82519 22.75 9.63423 22.75 11.9426 22.75H12.0574C14.3658 22.75 16.1748 22.75 17.5863 22.5603C19.031 22.366 20.1711 21.9607 21.0659 21.0659C21.9607 20.1711 22.366 19.031 22.5603 17.5863C22.75 16.1748 22.75 14.3658 22.75 12.0574V11.9426C22.75 9.63423 22.75 7.82519 22.5603 6.41371C22.366 4.96897 21.9607 3.82895 21.0659 2.93414C20.1711 2.03933 19.031 1.63399 17.5863 1.43975C16.1748 1.24998 14.3658 1.24999 12.0574 1.25H11.9426ZM3.9948 3.9948C4.56445 3.42514 5.33517 3.09825 6.61358 2.92637C7.91356 2.75159 9.62178 2.75 12 2.75C14.3782 2.75 16.0864 2.75159 17.3864 2.92637C18.6648 3.09825 19.4355 3.42514 20.0052 3.9948C20.5749 4.56445 20.9018 5.33517 21.0736 6.61358C21.2484 7.91356 21.25 9.62178 21.25 12C21.25 14.3782 21.2484 16.0864 21.0736 17.3864C20.9018 18.6648 20.5749 19.4355 20.0052 20.0052C19.4355 20.5749 18.6648 20.9018 17.3864 21.0736C16.0864 21.2484 14.3782 21.25 12 21.25C9.62178 21.25 7.91356 21.2484 6.61358 21.0736C5.33517 20.9018 4.56445 20.5749 3.9948 20.0052C3.42514 19.4355 3.09825 18.6648 2.92637 17.3864C2.75159 16.0864 2.75 14.3782 2.75 12C2.75 9.62178 2.75159 7.91356 2.92637 6.61358C3.09825 5.33517 3.42514 4.56445 3.9948 3.9948Z" fill="currentColor" app="ikonik" class="path-8iy7vg"></path>
                    <path d="M17.5762 10.4801C17.8413 10.1619 17.7983 9.68901 17.4801 9.42383C17.1619 9.15866 16.689 9.20165 16.4238 9.51986L14.6269 11.6761C14.2562 12.1211 14.0284 12.3915 13.8409 12.5609C13.7539 12.6394 13.7023 12.6708 13.6775 12.6827C13.6725 12.6852 13.6689 12.6866 13.6667 12.6875C13.6644 12.6866 13.6608 12.6852 13.6558 12.6827C13.6311 12.6708 13.5795 12.6394 13.4925 12.5609C13.3049 12.3915 13.0772 12.1211 12.7064 11.6761L12.414 11.3252C12.0855 10.931 11.7894 10.5756 11.5128 10.3258C11.2119 10.0541 10.8328 9.81205 10.3333 9.81205C9.83385 9.81205 9.45478 10.0541 9.15384 10.3258C8.87725 10.5756 8.58113 10.931 8.25267 11.3253L6.42383 13.5199C6.15866 13.8381 6.20165 14.311 6.51986 14.5762C6.83807 14.8413 7.31099 14.7983 7.57617 14.4801L9.37306 12.3239C9.74385 11.8789 9.97155 11.6085 10.1591 11.4391C10.2461 11.3606 10.2977 11.3292 10.3225 11.3173C10.3275 11.3148 10.3311 11.3134 10.3333 11.3125C10.3356 11.3134 10.3392 11.3148 10.3442 11.3173C10.3689 11.3292 10.4205 11.3606 10.5075 11.4391C10.6951 11.6085 10.9228 11.8789 11.2936 12.3239L11.586 12.6748C11.9145 13.069 12.2106 13.4244 12.4872 13.6742C12.7881 13.9459 13.1672 14.188 13.6667 14.188C14.1662 14.188 14.5452 13.9459 14.8462 13.6742C15.1228 13.4244 15.4189 13.069 15.7473 12.6748L17.5762 10.4801Z" fill="currentColor" app="ikonik" class="path-qc3rc"></path>
                  </svg>
                </a>
                <a href="#" data-w-id="f1a21736-2746-bf4f-0756-42659b8440b1" class="link-block-17 w-inline-block">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke-width="1.3" stroke="currentColor" aria-hidden="true" app="ikonik" class="ikonik-z2rs3">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6.429 9.75L2.25 12l4.179 2.25m0-4.5l5.571 3 5.571-3m-11.142 0L2.25 7.5 12 2.25l9.75 5.25-4.179 2.25m0 0L21.75 12l-4.179 2.25m0 0l4.179 2.25L12 21.75 2.25 16.5l4.179-2.25m11.142 0l-5.571 3-5.571-3" app="ikonik"></path>
                  </svg>
                </a>
              </div>
              <div data-w-id="f1a21736-2746-bf4f-0756-42659b8440b4" class="div-block-296" id="charttheme">
                <div class="div-block-298">
                  <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none" app="ikonik" class="ikonik-11k9l">
                    <defs app="ikonik">
                      <clipPath app="ikonik">
                        <rect width="24" height="24" fill="currentColor" app="ikonik" class="rect-r9vff"></rect>
                      </clipPath>
                    </defs>
                    <g clip-path="url(#clip0_201_56508)" app="ikonik">
                      <path d="M12.5756 23.2503C9.40805 23.2503 6.43598 22.0226 4.2068 19.7935C1.97761 17.5644 0.75 14.5921 0.75 11.4246C0.749527 9.23944 1.35457 7.09692 2.49796 5.23481C3.64135 3.3727 5.27838 1.86385 7.22733 0.875728C7.42784 0.773515 7.65401 0.732625 7.87762 0.758163C8.10122 0.7837 8.31236 0.874533 8.48466 1.01932C8.65696 1.16411 8.78279 1.35645 8.84646 1.57231C8.91012 1.78818 8.9088 2.01802 8.84264 2.23313C8.2865 4.02948 8.23184 5.94366 8.68457 7.76882C9.1373 9.59397 10.0802 11.2607 11.4114 12.5889C12.3667 13.5513 13.5034 14.3147 14.7557 14.8348C16.008 15.3549 17.3511 15.6215 18.7071 15.619C19.7445 15.6198 20.776 15.4642 21.767 15.1575C21.9821 15.0913 22.212 15.09 22.4279 15.1536C22.6438 15.2173 22.8361 15.3431 22.9809 15.5154C23.1257 15.6877 23.2166 15.8989 23.2421 16.1225C23.2676 16.3462 23.2267 16.5724 23.1244 16.7729C22.1363 18.7218 20.6274 20.3589 18.7653 21.5023C16.9032 22.6457 14.7607 23.2507 12.5756 23.2503ZM7.18641 2.61503C5.6751 3.53456 4.42667 4.82857 3.56189 6.37186C2.69711 7.91516 2.24524 9.65551 2.25 11.4246C2.25 17.1181 6.882 21.7503 12.5756 21.7503C14.3446 21.7551 16.085 21.3032 17.6283 20.4384C19.1716 19.5736 20.4656 18.3252 21.3852 16.8139C20.507 17.0171 19.6086 17.1195 18.7072 17.1192C17.1541 17.1221 15.6159 16.817 14.1815 16.2215C12.7471 15.6259 11.4451 14.7518 10.3509 13.6497C8.92934 12.2308 7.8928 10.4731 7.33912 8.54246C6.78544 6.61181 6.73288 4.57191 7.18641 2.61531V2.61503Z" fill="currentColor" app="ikonik" class="path-166dz"></path>
                    </g>
                  </svg>
                </div>
                <div class="div-block-297" >
                  <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="36" height="36" viewBox="0 0 32 32" app="ikonik" class="ikonik-bu4ko">
                    <rect fill="none" width="32" height="32" app="ikonik"></rect>
                    <rect x="15" y="2.0049" width="2" height="5" app="ikonik"></rect>
                    <rect x="21.6675" y="6.8536" width="4.958" height="1.9998" transform="translate(1.5191 19.3793) rotate(-45)" app="ikonik"></rect>
                    <rect x="25" y="15.0049" width="5" height="2" app="ikonik"></rect>
                    <rect x="23.1466" y="21.6675" width="1.9998" height="4.958" transform="translate(-10.0018 24.1514) rotate(-45)" app="ikonik"></rect>
                    <rect x="15" y="25.0049" width="2" height="5" app="ikonik"></rect>
                    <rect x="5.3745" y="23.1466" width="4.958" height="1.9998" transform="translate(-14.7739 12.6305) rotate(-45)" app="ikonik"></rect>
                    <rect x="2" y="15.0049" width="5" height="2" app="ikonik"></rect>
                    <rect x="6.8536" y="5.3745" width="1.9998" height="4.958" transform="translate(-3.253 7.8584) rotate(-45)" app="ikonik"></rect>
                    <path d="M16,12a4,4,0,1,1-4,4,4.0045,4.0045,0,0,1,4-4m0-2a6,6,0,1,0,6,6,6,6,0,0,0-6-6Z" transform="translate(0 0.0049)" app="ikonik"></path>
                  </svg>
                </div>
              </div>
              <div data-w-id="f1a21736-2746-bf4f-0756-42659b8440c8" class="div-block-446">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" app="ikonik" class="ikonik-futrh">
                  <circle r="3" transform="matrix(-1 0 0 1 8 16)" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" app="ikonik" class="circle-ttutfk"></circle>
                  <circle cx="16" cy="8" r="3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" app="ikonik" class="circle-pdimk"></circle>
                  <path d="M22 16H11M2 16H5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" app="ikonik" class="path-wc5mu"></path>
                  <path d="M2 8H13M22 8H19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" app="ikonik" class="path-q2njz"></path>
                </svg>
              </div>
              <div class="div-block-452">
                <div class="connect">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" app="ikonik" class="ikonik-319tq">
                    <path d="M2.00098 11.249C1.58676 11.249 1.25098 11.5848 1.25098 11.999C1.25098 12.4132 1.58676 12.749 2.00098 12.749L13.9735 12.749L12.0129 14.4296C11.6984 14.6991 11.662 15.1726 11.9315 15.4871C12.2011 15.8016 12.6746 15.838 12.9891 15.5685L16.4891 12.5685C16.6553 12.426 16.751 12.218 16.751 11.999C16.751 11.7801 16.6553 11.5721 16.4891 11.4296L12.9891 8.42958C12.6746 8.16002 12.2011 8.19644 11.9315 8.51093C11.662 8.82543 11.6984 9.2989 12.0129 9.56847L13.9735 11.249L2.00098 11.249Z" fill="currentColor" app="ikonik" class="path-hvk34j"></path>
                    <path d="M14.9453 1.25C13.5778 1.24998 12.4754 1.24996 11.6085 1.36652C10.7084 1.48754 9.95048 1.74643 9.34857 2.34835C8.82363 2.87328 8.55839 3.51836 8.41916 4.27635C8.28387 5.01291 8.25799 5.9143 8.25196 6.99583C8.24966 7.41003 8.58357 7.74768 8.99778 7.74999C9.41199 7.7523 9.74964 7.41838 9.75194 7.00418C9.75803 5.91068 9.78643 5.1356 9.89448 4.54735C9.99859 3.98054 10.1658 3.65246 10.4092 3.40901C10.686 3.13225 11.0746 2.9518 11.8083 2.85315C12.5637 2.75159 13.5648 2.75 15.0002 2.75H16.0002C17.4356 2.75 18.4367 2.75159 19.1921 2.85315C19.9259 2.9518 20.3144 3.13225 20.5912 3.40901C20.868 3.68577 21.0484 4.07435 21.1471 4.80812C21.2486 5.56347 21.2502 6.56459 21.2502 8V16C21.2502 17.4354 21.2486 18.4365 21.1471 19.1919C21.0484 19.9257 20.868 20.3142 20.5912 20.591C20.3144 20.8678 19.9259 21.0482 19.1921 21.1469C18.4367 21.2484 17.4356 21.25 16.0002 21.25H15.0002C13.5648 21.25 12.5637 21.2484 11.8083 21.1469C11.0746 21.0482 10.686 20.8678 10.4092 20.591C10.1658 20.3475 9.99859 20.0195 9.89448 19.4527C9.78643 18.8644 9.75803 18.0893 9.75194 16.9958C9.74964 16.5816 9.41199 16.2477 8.99778 16.25C8.58357 16.2523 8.24966 16.59 8.25196 17.0042C8.25799 18.0857 8.28387 18.9871 8.41916 19.7236C8.55839 20.4816 8.82363 21.1267 9.34857 21.6517C9.95048 22.2536 10.7084 22.5125 11.6085 22.6335C12.4754 22.75 13.5778 22.75 14.9453 22.75H16.0551C17.4227 22.75 18.525 22.75 19.392 22.6335C20.2921 22.5125 21.0499 22.2536 21.6519 21.6517C22.2538 21.0497 22.5127 20.2919 22.6337 19.3918C22.7503 18.5248 22.7502 17.4225 22.7502 16.0549V7.94513C22.7502 6.57754 22.7503 5.47522 22.6337 4.60825C22.5127 3.70814 22.2538 2.95027 21.6519 2.34835C21.0499 1.74643 20.2921 1.48754 19.392 1.36652C18.525 1.24996 17.4227 1.24998 16.0551 1.25H14.9453Z" fill="currentColor" app="ikonik" class="path-yd5j6"></path>
                  </svg>
                </div>
                <div class="disconnect">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" app="ikonik" class="ikonik-6uxxwj">
                    <path d="M15 11.25C15.4142 11.25 15.75 11.5858 15.75 12C15.75 12.4142 15.4142 12.75 15 12.75H4.02744L5.98809 14.4306C6.30259 14.7001 6.33901 15.1736 6.06944 15.4881C5.79988 15.8026 5.3264 15.839 5.01191 15.5694L1.51191 12.5694C1.34567 12.427 1.25 12.2189 1.25 12C1.25 11.7811 1.34567 11.573 1.51191 11.4306L5.01191 8.43056C5.3264 8.16099 5.79988 8.19741 6.06944 8.51191C6.33901 8.8264 6.30259 9.29988 5.98809 9.56944L4.02744 11.25H15Z" fill="currentColor" app="ikonik" class="path-gzc7c"></path>
                    <path d="M14.9453 1.25C13.5778 1.24998 12.4754 1.24996 11.6085 1.36652C10.7084 1.48754 9.95048 1.74643 9.34857 2.34835C8.82363 2.87328 8.55839 3.51836 8.41916 4.27635C8.28387 5.01291 8.25799 5.9143 8.25196 6.99583C8.24966 7.41003 8.58357 7.74768 8.99778 7.74999C9.41199 7.7523 9.74964 7.41838 9.75194 7.00418C9.75803 5.91068 9.78643 5.1356 9.89448 4.54735C9.99859 3.98054 10.1658 3.65246 10.4092 3.40901C10.686 3.13225 11.0746 2.9518 11.8083 2.85315C12.5637 2.75159 13.5648 2.75 15.0002 2.75H16.0002C17.4356 2.75 18.4367 2.75159 19.1921 2.85315C19.9259 2.9518 20.3144 3.13225 20.5912 3.40901C20.868 3.68577 21.0484 4.07435 21.1471 4.80812C21.2486 5.56347 21.2502 6.56459 21.2502 8V16C21.2502 17.4354 21.2486 18.4365 21.1471 19.1919C21.0484 19.9257 20.868 20.3142 20.5912 20.591C20.3144 20.8678 19.9259 21.0482 19.1921 21.1469C18.4367 21.2484 17.4356 21.25 16.0002 21.25H15.0002C13.5648 21.25 12.5637 21.2484 11.8083 21.1469C11.0746 21.0482 10.686 20.8678 10.4092 20.591C10.1658 20.3475 9.99859 20.0195 9.89448 19.4527C9.78643 18.8644 9.75803 18.0893 9.75194 16.9958C9.74964 16.5816 9.41199 16.2477 8.99778 16.25C8.58357 16.2523 8.24966 16.59 8.25196 17.0042C8.25799 18.0857 8.28387 18.9871 8.41916 19.7236C8.55839 20.4816 8.82363 21.1267 9.34857 21.6517C9.95048 22.2536 10.7084 22.5125 11.6085 22.6335C12.4754 22.75 13.5778 22.75 14.9453 22.75H16.0551C17.4227 22.75 18.525 22.75 19.392 22.6335C20.2921 22.5125 21.0499 22.2536 21.6519 21.6517C22.2538 21.0497 22.5127 20.2919 22.6337 19.3918C22.7503 18.5248 22.7502 17.4225 22.7502 16.0549V7.94513C22.7502 6.57754 22.7503 5.47522 22.6337 4.60825C22.5127 3.70814 22.2538 2.95027 21.6519 2.34835C21.0499 1.74643 20.2921 1.48754 19.392 1.36652C18.525 1.24996 17.4227 1.24998 16.0551 1.25H14.9453Z" fill="currentColor" app="ikonik" class="path-zby7zj"></path>
                  </svg>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div>
        <section id="trade" class="trade">
          <div class="div-block-107">
            <div class="w-layout-grid grid-16">
              <div class="div-block-132">
                <div class="div-block-133">
                  <div class="div-block-470">
                    <a href="#" class="link-block-19 w-inline-block" onclick="selectAsset('AAPL'); return false;">
                        <div class="w-layout-grid grid-42">
                          <div>
                            <div class="text-block-245">AAPL</div>
                            <div class="text-block-233">APPLE INC.</div>
                          </div>
                          <div class="w-clearfix">
                            <div id="price-49f6b65cb1de6b10eaf75e7c03ca029c306d0357e91b5311b175084a5ad55688" class="text-block-244">192.88</div>
                            <div class="div-block-488">
                              <div class="text-block-234"><span class="asset-percentage" id="percentage-0">...</span></div>
                            </div>
                          </div>
                        </div>
                      </a>
                      <a href="#" class="link-block-19 w-inline-block" onclick="selectAsset('AMZN'); return false;">
                        <div class="w-layout-grid grid-42">
                          <div>
                            <div class="text-block-245">AMZN</div>
                            <div class="text-block-233">AMAZON</div>
                          </div>
                          <div class="w-clearfix">
                            <div id="price-b5d0e0fa58a1f8b81498ae670ce93c872d14434b72c364885d4fa1b257cbb07a" class="text-block-244">192.88</div>
                            <div class="div-block-488">
                              <div class="text-block-234"><span class="asset-percentage" id="percentage-1">...</span></div>
                            </div>
                          </div>
                        </div>
                      </a>
                      <a href="#" class="link-block-19 w-inline-block" onclick="selectAsset('COIN'); return false;">
                        <div class="w-layout-grid grid-42">
                          <div>
                            <div class="text-block-245">COIN</div>
                            <div class="text-block-233">COINBASE</div>
                          </div>
                          <div class="w-clearfix">
                            <div id="price-fee33f2a978bf32dd6b662b65ba8083c6773b494f8401194ec1870c640860245" class="text-block-244">192.88</div>
                            <div class="div-block-488">
                              <div class="text-block-234"><span class="asset-percentage" id="percentage-2">...</span></div>
                            </div>
                          </div>
                        </div>
                      </a>
                      <a href="#" class="link-block-19 w-inline-block" onclick="selectAsset('GOOG'); return false;">
                        <div class="w-layout-grid grid-42">
                          <div>
                            <div class="text-block-245">GOOG</div>
                            <div class="text-block-233">ALPHABET INC.</div>
                          </div>
                          <div class="w-clearfix">
                            <div id="price-e65ff435be42630439c96396653a342829e877e2aafaeaf1a10d0ee5fd2cf3f2" class="text-block-244">192.88</div>
                            <div class="div-block-488">
                              <div class="text-block-234"><span class="asset-percentage" id="percentage-3">...</span></div>
                            </div>
                          </div>
                        </div>
                      </a>
                      <a href="#" class="link-block-19 w-inline-block" onclick="selectAsset('GME'); return false;">
                        <div class="w-layout-grid grid-42">
                          <div>
                            <div class="text-block-245">GME</div>
                            <div class="text-block-233">GAMESTOP CORP.</div>
                          </div>
                          <div class="w-clearfix">
                            <div id="price-6f9cd89ef1b7fd39f667101a91ad578b6c6ace4579d5f7f285a4b06aa4504be6" class="text-block-244">192.88</div>
                            <div class="div-block-488">
                              <div class="text-block-234"><span class="asset-percentage" id="percentage-4">...</span></div>
                            </div>
                          </div>
                        </div>
                      </a>
                      <a href="#" class="link-block-19 w-inline-block" onclick="selectAsset('INTC'); return false;">
                        <div class="w-layout-grid grid-42">
                          <div>
                            <div class="text-block-245">INTC</div>
                            <div class="text-block-233">INTEL CORPORATION</div>
                          </div>
                          <div class="w-clearfix">
                            <div id="price-c1751e085ee292b8b3b9dd122a135614485a201c35dfc653553f0e28c1baf3ff" class="text-block-244">192.88</div>
                            <div class="div-block-488">
                              <div class="text-block-234"><span class="asset-percentage" id="percentage-5">...</span></div>
                            </div>
                          </div>
                        </div>
                      </a>
                      <a href="#" class="link-block-19 w-inline-block" onclick="selectAsset('KO'); return false;">
                        <div class="w-layout-grid grid-42">
                          <div>
                            <div class="text-block-245">KO</div>
                            <div class="text-block-233">COCA-COLA CO</div>
                          </div>
                          <div class="w-clearfix">
                            <div id="price-9aa471dccea36b90703325225ac76189baf7e0cc286b8843de1de4f31f9caa7d" class="text-block-244">192.88</div>
                            <div class="div-block-488">
                              <div class="text-block-234"><span class="asset-percentage" id="percentage-6">...</span></div>
                            </div>
                          </div>
                        </div>
                      </a>
                      <a href="#" class="link-block-19 w-inline-block" onclick="selectAsset('MCD'); return false;">
                        <div class="w-layout-grid grid-42">
                          <div>
                            <div class="text-block-245">MCD</div>
                            <div class="text-block-233">
                              <strong>
                                <code class="code">MCDONALD'S CORP</code>
                              </strong>
                            </div>
                          </div>
                          <div class="w-clearfix">
                            <div id="price-d3178156b7c0f6ce10d6da7d347952a672467b51708baaf1a57ffe1fb005824a" class="text-block-244">192.88</div>
                            <div class="div-block-488">
                              <div class="text-block-234"><span class="asset-percentage" id="percentage-7">...</span></div>
                            </div>
                          </div>
                        </div>
                      </a>
                      <a href="#" class="link-block-19 w-inline-block" onclick="selectAsset('MSFT'); return false;">
                        <div class="w-layout-grid grid-42">
                          <div>
                            <div class="text-block-245">MFST</div>
                            <div class="text-block-233">MICROSOFT CORP</div>
                          </div>
                          <div class="w-clearfix">
                            <div id="price-d0ca23c1cc005e004ccf1db5bf76aeb6a49218f43dac3d4b275e92de12ded4d1" class="text-block-244">192.88</div>
                            <div class="div-block-488">
                              <div class="text-block-234"><span class="asset-percentage" id="percentage-8">...</span></div>
                            </div>
                          </div>
                        </div>
                      </a>
                      <a href="#" class="link-block-19 w-inline-block" onclick="selectAsset('NKE'); return false;">
                        <div class="w-layout-grid grid-42">
                          <div>
                            <div class="text-block-245">NKE</div>
                            <div class="text-block-233">NIKE INC</div>
                          </div>
                          <div class="w-clearfix">
                            <div id="price-67649450b4ca4bfff97cbaf96d2fd9e40f6db148cb65999140154415e4378e14" class="text-block-244">192.88</div>
                            <div class="div-block-488">
                              <div class="text-block-234"><span class="asset-percentage" id="percentage-9">...</span></div>
                            </div>
                          </div>
                        </div>
                      </a>
                      <a href="#" class="link-block-19 w-inline-block" onclick="selectAsset('META'); return false;">
                        <div class="w-layout-grid grid-42">
                          <div>
                            <div class="text-block-245">META</div>
                            <div class="text-block-233">META PLATFORMS INC</div>
                          </div>
                          <div class="w-clearfix">
                            <div id="price-b1073854ed24cbc755dc527418f52b7d271f6cc967bbf8d8129112b18860a593" class="text-block-244">192.88</div>
                            <div class="div-block-488">
                              <div class="text-block-234"><span class="asset-percentage" id="percentage-10">...</span></div>
                            </div>
                          </div>
                        </div>
                      </a>
                      <a href="#" class="link-block-19 w-inline-block" onclick="selectAsset('NVDA'); return false;">
                        <div class="w-layout-grid grid-42">
                          <div>
                            <div class="text-block-245">NVDA</div>
                            <div class="text-block-233">NVIDIA CORP</div>
                          </div>
                          <div class="w-clearfix">
                            <div id="price-78a3e3b8e676a8f73c439f5d749737034b139bbbe899ba5775216fba596607fe" class="text-block-244">192.88</div>
                            <div class="div-block-488">
                              <div class="text-block-234"><span class="asset-percentage" id="percentage-11">...</span></div>
                            </div>
                          </div>
                        </div>
                      </a>
                      <a href="#" class="link-block-19 w-inline-block" onclick="selectAsset('TSLA'); return false;">
                        <div class="w-layout-grid grid-42">
                          <div>
                            <div class="text-block-245">TSLA</div>
                            <div class="text-block-233">TESLA INC</div>
                          </div>
                          <div class="w-clearfix">
                            <div id="price-16dad506d7db8da01c87581c87ca897a012a153557d4d578c3b9c9e1bc0632f1" class="text-block-244">192.88</div>
                            <div class="div-block-488">
                              <div class="text-block-234"><span class="asset-percentage" id="percentage-12">...</span></div>
                            </div>
                          </div>
                        </div>
                      </a>
                      <a href="#" class="link-block-19 w-inline-block" onclick="selectAsset('AUDUSD'); return false;">
                        <div class="w-layout-grid grid-42">
                          <div>
                            <div class="text-block-245">AUD/USD</div>
                            <div class="text-block-233">AUSTRALIAN DOLLAR</div>
                          </div>
                          <div class="w-clearfix">
                            <div id="price-67a6f93030420c1c9e3fe37c1ab6b77966af82f995944a9fefce357a22854a80" class="text-block-244">192.88</div>
                            <div class="div-block-488">
                              <div class="text-block-234"><span class="asset-percentage" id="percentage-13">...</span></div>
                            </div>
                          </div>
                        </div>
                      </a>
                      <a href="#" class="link-block-19 w-inline-block" onclick="selectAsset('EURUSD'); return false;">
                        <div class="w-layout-grid grid-42">
                          <div>
                            <div class="text-block-245">EUR/USD</div>
                            <div class="text-block-233">EURO</div>
                          </div>
                          <div class="w-clearfix">
                            <div id="price-a995d00bb36a63cef7fd2c287dc105fc8f3d93779f062f09551b0af3e81ec30b" class="text-block-244">192.88</div>
                            <div class="div-block-488">
                              <div class="text-block-234"><span class="asset-percentage" id="percentage-14">...</span></div>
                            </div>
                          </div>
                        </div>
                      </a>
                      <a href="#" class="link-block-19 w-inline-block" onclick="selectAsset('GBPUSD'); return false;">
                        <div class="w-layout-grid grid-42">
                          <div>
                            <div class="text-block-245">GBP/USD</div>
                            <div class="text-block-233">
                              <strong>
                                <code class="code">BRITISH POUND</code>
                              </strong>
                            </div>
                          </div>
                          <div class="w-clearfix">
                            <div id="price-84c2dde9633d93d1bcad84e7dc41c9d56578b7ec52fabedc1f335d673df0a7c1" class="text-block-244">192.88</div>
                            <div class="div-block-488">
                              <div class="text-block-234"><span class="asset-percentage" id="percentage-15">...</span></div>
                            </div>
                          </div>
                        </div>
                      </a>
                      <a href="#" class="link-block-19 w-inline-block" onclick="selectAsset('NZDUSD'); return false;">
                        <div class="w-layout-grid grid-42">
                          <div>
                            <div class="text-block-245">NZD/USD</div>
                            <div class="text-block-233">
                              <strong>
                                <code class="code">NEW ZEALAND DOLLAR</code>
                              </strong>
                            </div>
                          </div>
                          <div class="w-clearfix">
                            <div id="price-92eea8ba1b00078cdc2ef6f64f091f262e8c7d0576ee4677572f314ebfafa4c7" class="text-block-244">192.88</div>
                            <div class="div-block-488">
                              <div class="text-block-234"><span class="asset-percentage" id="percentage-16">...</span></div>
                            </div>
                          </div>
                        </div>
                      </a>
                      <a href="#" class="link-block-19 w-inline-block" onclick="selectAsset('USDCAD'); return false;">
                        <div class="w-layout-grid grid-42">
                          <div>
                            <div class="text-block-245">USD/CAD</div>
                            <div class="text-block-233">CANADIAN DOLLAR</div>
                          </div>
                          <div class="w-clearfix">
                            <div id="price-3112b03a41c910ed446852aacf67118cb1bec67b2cd0b9a214c58cc0eaa2ecca" class="text-block-244">192.88</div>
                            <div class="div-block-488">
                              <div class="text-block-234"><span class="asset-percentage" id="percentage-17">...</span></div>
                            </div>
                          </div>
                        </div>
                      </a>
                      <a href="#" class="link-block-19 w-inline-block" onclick="selectAsset('USDCHF'); return false;">
                        <div class="w-layout-grid grid-42">
                          <div>
                            <div class="text-block-245">USD/CHF</div>
                            <div class="text-block-233">SWISS FRANC</div>
                          </div>
                          <div class="w-clearfix">
                            <div id="price-ef2c98c804ba503c6a707e38be4dfbb16683775f195b091252bf24693042fd52" class="text-block-244">192.88</div>
                            <div class="div-block-488">
                              <div class="text-block-234"><span class="asset-percentage" id="percentage-18">...</span></div>
                            </div>
                          </div>
                        </div>
                      </a>
                      <a href="#" class="link-block-19 w-inline-block" onclick="selectAsset('USDJPY'); return false;">
                        <div class="w-layout-grid grid-42">
                          <div>
                            <div class="text-block-245">USD/JPY</div>
                            <div class="text-block-233">
                              <strong>
                                <code class="code">JAPANESE YEN</code>
                              </strong>
                            </div>
                          </div>
                          <div class="w-clearfix">
                            <div id="price-0b1e3297e69f162877b577b0d6a47a0d63b2392bc8499e6540da4187a63e28f8" class="text-block-244">192.88</div>
                            <div class="div-block-488">
                              <div class="text-block-234"><span class="asset-percentage" id="percentage-19">...</span></div>
                            </div>
                          </div>
                        </div>
                      </a>
                      <a href="#" class="link-block-19 w-inline-block" onclick="selectAsset('XAUUSD'); return false;">
                        <div class="w-layout-grid grid-42">
                          <div>
                            <div class="text-block-245">XAU/USD</div>
                            <div class="text-block-233">GOLD</div>
                          </div>
                          <div class="w-clearfix">
                            <div id="price-f2fb02c32b055c805e7238d628e5e9dadef274376114eb1f012337cabe93871e" class="text-block-244">192.88</div>
                            <div class="div-block-488">
                              <div class="text-block-234"><span class="asset-percentage" id="percentage-20">...</span></div>
                            </div>
                          </div>
                        </div>
                      </a>
                      <a href="#" class="link-block-19 w-inline-block" onclick="selectAsset('XAGUSD'); return false;">
                        <div class="w-layout-grid grid-42">
                          <div>
                            <div class="text-block-245">XAG/USD</div>
                            <div class="text-block-233">Silver</div>
                          </div>
                          <div class="w-clearfix">
                            <div id="price-765d2ba906dbc32ca17cc11f5310a89e9ee1f6420508c63861f2f8ba4ee34bb2" class="text-block-244">192.88</div>
                            <div class="div-block-488">
                              <div class="text-block-234"><span class="asset-percentage" id="percentage-21">...</span></div>
                            </div>
                          </div>
                        </div>
                      </a>
                    <div class="div-block-495">
                      <div id="w-node-_655bec7b-eaf2-c952-5d89-dbca9e08e6b4-1f521c30" class="text-block-224">SYMBOL</div>
                      <div id="w-node-_655bec7b-eaf2-c952-5d89-dbca9e08e6b6-1f521c30" class="text-block-224">LAST/CHANGE</div>
                    </div>
                  </div>
                </div>
                <div class="div-block-490">
                  <div>
                    <div class="w-layout-grid grid-17">
                      <div class="div-block-493">
                        <div class="div-block-483">
                          <div class="div-block-479">
                            <div class="div-block-474">
                              <div data-w-id="655bec7b-eaf2-c952-5d89-dbca9e08e6bf" class="text-block-231" id=base>AAPL</div>
                            </div>
                            <a data-w-id="655bec7b-eaf2-c952-5d89-dbca9e08e6c1" href="#" class="button-102 w-button"  data-resolution="1" >1M</a>
                            <a data-w-id="655bec7b-eaf2-c952-5d89-dbca9e08e6c3" href="#" class="button-106 w-button" data-resolution="5" >5M</a>
                            <a data-w-id="655bec7b-eaf2-c952-5d89-dbca9e08e6c5" href="#" class="button-101 w-button" data-resolution="15">15M</a>
                            <a data-w-id="655bec7b-eaf2-c952-5d89-dbca9e08e6c7" href="#" class="button-92 w-button" data-resolution="60">1H</a>
                            <a data-w-id="655bec7b-eaf2-c952-5d89-dbca9e08e6c9" href="#" class="button-95 w-button" data-resolution="240">4H</a>
                            <a data-w-id="655bec7b-eaf2-c952-5d89-dbca9e08e6cb" href="#" class="button-105 w-button" data-resolution="D">1D</a>
                            <div class="div-block-475"></div>
                            <div class="div-block-478"></div>
                            <div class="div-block-496" id="chartTypeToggle">
                              <a data-w-id="655bec7b-eaf2-c952-5d89-dbca9e08e6d0" href="#" class="link-block-18 w-inline-block">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" app="ikonik" class="ikonik-mc3dr">
                                  <path d="M7 16L12.25 10.75L15.75 14.25L21 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" app="ikonik" class="path-cy7k1"></path>
                                  <path d="M21 21H3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" app="ikonik" class="path-grztl"></path>
                                  <path d="M3 3V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" app="ikonik" class="path-t2hxn"></path>
                                </svg>
                              </a>
                            </div>
                            <a id="w-node-_655bec7b-eaf2-c952-5d89-dbca9e08e6d8-1f521c30"   data-w-id="655bec7b-eaf2-c952-5d89-dbca9e08e6d8" href="#" class="link-block-3 w-inline-block">
                              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16" app="ikonik" class="ikonik-vgkxni">
                                <path d="M1.5 1a.5.5 0 0 0-.5.5v4a.5.5 0 0 1-1 0v-4A1.5 1.5 0 0 1 1.5 0h4a.5.5 0 0 1 0 1zM10 .5a.5.5 0 0 1 .5-.5h4A1.5 1.5 0 0 1 16 1.5v4a.5.5 0 0 1-1 0v-4a.5.5 0 0 0-.5-.5h-4a.5.5 0 0 1-.5-.5M.5 10a.5.5 0 0 1 .5.5v4a.5.5 0 0 0 .5.5h4a.5.5 0 0 1 0 1h-4A1.5 1.5 0 0 1 0 14.5v-4a.5.5 0 0 1 .5-.5m15 0a.5.5 0 0 1 .5.5v4a1.5 1.5 0 0 1-1.5 1.5h-4a.5.5 0 0 1 0-1h4a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 1 .5-.5" app="ikonik"></path>
                              </svg>
                              <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" viewBox="0 0 16 16" app="ikonik" class="ikonik-rk5d1">
                                <path d="M5.5 0a.5.5 0 0 1 .5.5v4A1.5 1.5 0 0 1 4.5 6h-4a.5.5 0 0 1 0-1h4a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 1 .5-.5m5 0a.5.5 0 0 1 .5.5v4a.5.5 0 0 0 .5.5h4a.5.5 0 0 1 0 1h-4A1.5 1.5 0 0 1 10 4.5v-4a.5.5 0 0 1 .5-.5M0 10.5a.5.5 0 0 1 .5-.5h4A1.5 1.5 0 0 1 6 11.5v4a.5.5 0 0 1-1 0v-4a.5.5 0 0 0-.5-.5h-4a.5.5 0 0 1-.5-.5m10 1a1.5 1.5 0 0 1 1.5-1.5h4a.5.5 0 0 1 0 1h-4a.5.5 0 0 0-.5.5v4a.5.5 0 0 1-1 0z" app="ikonik"></path>
                              </svg>
                            </a>
                          </div>
                        </div>
                      </div>
                      <div class="div-block-472">
                        <div class="div-block-492">
                          <div class="text-block-220">O:</div>
                          <div class="text-block-220"><span id="o">--</span></div>
                        </div>
                        <div class="div-block-492">
                          <div class="text-block-220">H:</div>
                          <div class="text-block-220"><span id="h">--</span></div>
                        </div>
                        <div class="div-block-492">
                          <div class="text-block-220">L:</div>
                          <div class="text-block-220"><span id="l">--</span></div>
                        </div>
                        <div class="div-block-492">
                          <div class="text-block-220">C:</div>
                          <div class="text-block-220"><span id="c">--</span></div>
                        </div>
                        <div class="div-block-494">
                          <div class="div-block-492">
                            <div class="text-block-220">V:</div>
                            <div class="text-block-220"> 201.20k</div>
                          </div>
                        </div>
                      </div>
                      <div><div id="chartContainer">
                        <div class="watermark">Brokex Protocol</div>
                      </div></div>
                      <div class="div-block-486">
                        <div>
                          <div class="text-block-242"><p id="walletAddress">Please connect your wallet
                        </p></div>
                        </div>
                        <div class="div-block-477">
                          <div class="div-block-466">
                            <div class="text-block-227" id="latency-result">...</div>
                            <div class="text-block-227">ms</div>
                          </div>
                          <div class="div-block-466">
                            <div class="text-block-227" id="speed-result">...</div>
                            <div class="text-block-227">Mbps</div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="div-block-487">
                <div class="div-block-462">
                  <div class="text-block-219"><div id="description"><span>--</span></div></div>
                  <div class="text-block-238"><div id="market_status"><span>--</span></div></div>
                </div>
                <div class="div-block-463">
                  <div class="w-layout-grid grid-41">
                    <div class="text-block-221"><div id="display_symbol"><span>--</span></div></div>
                    <div>
                      <div class="w-layout-grid grid-39">
                        <div>
                          <h1 class="heading-13"><span id="price">--</span></h1>
                          <div class="div-block-467">
                            <div class="text-block-229">-0,63</div>
                            <div class="text-block-223">-0.92%</div>
                          </div>
                        </div>
                        <div id="w-node-_655bec7b-eaf2-c952-5d89-dbca9e08e71c-1f521c30">
                          <div class="w-layout-grid grid-40">
                            <div id="w-node-_655bec7b-eaf2-c952-5d89-dbca9e08e71e-1f521c30" class="text-block-241">BID</div>
                            <div id="w-node-_655bec7b-eaf2-c952-5d89-dbca9e08e720-1f521c30" class="text-block-236"><span id="price-plus">--</span></div>
                            <div id="w-node-_655bec7b-eaf2-c952-5d89-dbca9e08e722-1f521c30" class="text-block-230">ASK</div>
                            <div id="w-node-_655bec7b-eaf2-c952-5d89-dbca9e08e724-1f521c30" class="text-block-232"><span id="price-minus">--</span></div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="div-block-473">
                  <a data-w-id="655bec7b-eaf2-c952-5d89-dbca9e08e727" href="#" class="button-108 w-button" onclick="setIsShortValue(false)">Buy</a>
                  <div class="div-block-480"></div>
                  <a data-w-id="655bec7b-eaf2-c952-5d89-dbca9e08e72a" href="#" class="button-93 w-button" onclick="setIsShortValue(true)">Sell</a>
                </div>
                <div>
                  <div class="div-block-476">
                    <a data-w-id="655bec7b-eaf2-c952-5d89-dbca9e08e72e" href="#" class="button-96 w-button">Market</a>
                    <a data-w-id="655bec7b-eaf2-c952-5d89-dbca9e08e730" href="#" class="button-94 w-button">Order</a>
                    <div style="-webkit-transform:translate3d(0px, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);-moz-transform:translate3d(0px, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);-ms-transform:translate3d(0px, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0);transform:translate3d(0px, 0, 0) scale3d(1, 1, 1) rotateX(0) rotateY(0) rotateZ(0) skew(0, 0)" class="div-block-469"></div>
                  </div>
                  <div class="div-block-491">
                    <div class="text-block-243">
                      <strong class="bold-text-7">Available</strong>
                    </div>
                    <div id="w-node-_655bec7b-eaf2-c952-5d89-dbca9e08e737-1f521c30" class="text-block-243">
                      <strong class="bold-text-7" id="walletBalance"></strong>
                    </div>
                  </div>
                  <div class="marketbook">
                    <div class="w-form">
                        <div class="div-block-481">
                          <div class="text-block-239">Ordre Size:</div>
                        </div>
                        <div class="div-block-412">
                          <input class="text-field-10 w-node-_655bec7b-eaf2-c952-5d89-dbca9e08e741-1f521c30 w-input" id="pos_size" placeholder="1000" type="number"  />
                          <div id="w-node-_655bec7b-eaf2-c952-5d89-dbca9e08e742-1f521c30" class="text-block-237">USDC</div>
                          <div class="div-block-468">
                            <a href="#" class="button-103 w-button" onclick="incrementNum('pos_size',1)">△</a>
                            <a href="#" class="button-104 w-button" onclick="incrementNum('pos_size',-1)">▽ <br />
                            </a>
                          </div>
                        </div>
                        <div class="div-block-471">
                          <a id="w-node-_655bec7b-eaf2-c952-5d89-dbca9e08e74b-1f521c30" href="#" class="button-97 w-button" onclick="applyPctOfBalancePos(25)">25 %</a>
                          <a id="w-node-_655bec7b-eaf2-c952-5d89-dbca9e08e74d-1f521c30" href="#" class="button-97 w-button" onclick="applyPctOfBalancePos(50)">50 %</a>
                          <a id="w-node-_655bec7b-eaf2-c952-5d89-dbca9e08e74f-1f521c30" href="#" class="button-97 w-button" onclick="applyPctOfBalancePos(75)">75 %</a>
                          <a id="w-node-_655bec7b-eaf2-c952-5d89-dbca9e08e751-1f521c30" href="#" class="button-98 w-button" onclick="applyPctOfBalancePos(100)">100 %</a>
                        </div>
                        <div class="div-block-481">
                          <div class="text-block-225">Leverage :</div>
                        </div>
                        <div class="div-block-482">
                          <a href="#" class="button-109 w-button">
                            <strong class="bold-text-16" onclick="setLeverage('pos_leverage',1)">×1</strong>
                          </a>
                          <a href="#" class="button-109 w-button">
                            <strong class="bold-text-2" onclick="setLeverage('pos_leverage',5)">×5</strong>
                          </a>
                          <a href="#" class="button-109 w-button">
                            <strong class="bold-text-4" onclick="setLeverage('pos_leverage',10)">×10</strong>
                          </a>
                          <a href="#" class="button-109 w-button">
                            <strong class="bold-text-4" onclick="setLeverage('pos_leverage',25)">×25</strong>
                          </a>
                          <input class="text-field-16 w-node-_655bec7b-eaf2-c952-5d89-dbca9e08e763-1f521c30 w-input" id="pos_leverage" placeholder="5" value="5" onchange="updateLiquidationPrice()" />
                          <div class="div-block-468">
                            <a href="#" class="button-103 w-button" onclick="incrementLeverage('pos_leverage',1)">△</a>
                            <a href="#" class="button-104 w-button" onclick="incrementLeverage('pos_leverage',-1)">▽ <br />
                            </a>
                          </div>
                        </div>
                        <div class="take-profit">
                          <div data-w-id="655bec7b-eaf2-c952-5d89-dbca9e08e76b" class="rl_faq6_question-3">
                            <a href="#" class="button-107 w-button" onclick="toggleSLTP()">Take Profit </a>
                            <div class="rl_faq6_icon-wrapper-3">
                              <div class="rl_faq6_icon-3 w-embed">
                                <svg width=" 100%" height=" 100%" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M25.3334 15.6668V16.3334C25.3334 16.7016 25.0349 17.0001 24.6667 17.0001H17.0001V24.6667C17.0001 25.0349 16.7016 25.3334 16.3334 25.3334H15.6667C15.2986 25.3334 15.0001 25.0349 15.0001 24.6667L15.0001 17.0001H7.33341C6.96522 17.0001 6.66675 16.7016 6.66675 16.3334V15.6668C6.66675 15.2986 6.96522 15.0001 7.33341 15.0001H15.0001V7.33341C15.0001 6.96522 15.2986 6.66675 15.6667 6.66675H16.3334C16.7016 6.66675 17.0001 6.96522 17.0001 7.33341V15.0001L24.6667 15.0001C25.0349 15.0001 25.3334 15.2986 25.3334 15.6668Z" fill="currentColor" />
                                </svg>
                              </div>
                            </div>
                          </div>
                          <div style="width:100%;height:0px" class="rl_faq6_answer-2">
                            <div class="rl_faq6_answer-wrapper-2">
                              <div class="div-block-464"></div>
                            </div>
                            <div class="div-block-489">
                              <input class="text-field-17 w-input" id="pos_tp"/>
                              <div class="text-block-237">Price</div>
                              <div class="div-block-468">
                                <a href="#" class="button-103 w-button" onclick="incrementNum('pos_tp',1)">△</a>
                                <a href="#" class="button-104 w-button" onclick="incrementNum('pos_tp',-1)">▽ <br />
                                </a>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="take-profit">
                          <div data-w-id="655bec7b-eaf2-c952-5d89-dbca9e08e77e" class="rl_faq6_question-3">
                            <a href="#" class="button-107 w-button" onclick="toggleSLTP()">Stop Loss</a>
                            <div class="rl_faq6_icon-wrapper-3">
                              <div class="rl_faq6_icon-3 w-embed">
                                <svg width=" 100%" height=" 100%" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M25.3334 15.6668V16.3334C25.3334 16.7016 25.0349 17.0001 24.6667 17.0001H17.0001V24.6667C17.0001 25.0349 16.7016 25.3334 16.3334 25.3334H15.6667C15.2986 25.3334 15.0001 25.0349 15.0001 24.6667L15.0001 17.0001H7.33341C6.96522 17.0001 6.66675 16.7016 6.66675 16.3334V15.6668C6.66675 15.2986 6.96522 15.0001 7.33341 15.0001H15.0001V7.33341C15.0001 6.96522 15.2986 6.66675 15.6667 6.66675H16.3334C16.7016 6.66675 17.0001 6.96522 17.0001 7.33341V15.0001L24.6667 15.0001C25.0349 15.0001 25.3334 15.2986 25.3334 15.6668Z" fill="currentColor" />
                                </svg>
                              </div>
                            </div>
                          </div>
                          <div style="width:100%;height:0px" class="rl_faq6_answer-2">
                            <div class="rl_faq6_answer-wrapper-2">
                              <div class="div-block-464"></div>
                            </div>
                            <div class="div-block-489">
                              <input class="text-field-17 w-input" id="pos_sl" />
                              <div class="text-block-237">Price</div>
                              <div class="div-block-468">
                                <a href="#" class="button-103 w-button" onclick="incrementNum('pos_sl',1)">△</a>
                                <a href="#" class="button-104 w-button" onclick="incrementNum('pos_sl',-1)">▽ <br />
                                </a>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="div-block-485">
                          <div class="div-block-465">
                            <div class="text-block-222">Entry Price : </div>
                            <div id="w-node-_655bec7b-eaf2-c952-5d89-dbca9e08e794-1f521c30" class="text-block-228">USDC</div>
                          </div>
                          <div class="div-block-465">
                            <div class="text-block-222">Size in USDT : </div>
                            <div class="text-block-228">USDC</div>
                          </div>
                          <div class="div-block-465">
                            <div id="w-node-_655bec7b-eaf2-c952-5d89-dbca9e08e79c-1f521c30" class="text-block-222">Fee in AVAX : </div>
                            <div class="text-block-228">AVAX</div>
                          </div>
                        </div>
                        <a href="#" class="button-99 w-button" onclick="openPositionAction()">Execute the order →</a>
                    </div>
                  </div>
                  <div class="orderblock">
                    <div class="form-block-14 w-form">
                        <div>
                          <div class="div-block-481">
                            <div class="text-block-235">Ordre Price:</div>
                          </div>
                        </div>
                        <div class="div-block-412">
                          <input class="text-field-10 w-node-_655bec7b-eaf2-c952-5d89-dbca9e08e7b0-1f521c30 w-input" id="limit_targetPrice" onchange="updateLimitOrderCalculations()" />
                          <div id="w-node-_655bec7b-eaf2-c952-5d89-dbca9e08e7b1-1f521c30" class="text-block-237">USDT</div>
                          <div class="div-block-468">
                            <a href="#" class="button-103 w-button" onclick="incrementNum('limit_targetPrice',1)">△</a>
                            <a href="#" class="button-104 w-button" onclick="incrementNum('limit_targetPrice',-1)">▽ <br />
                            </a>
                          </div>
                        </div>
                        <div class="div-block-481">
                          <div class="text-block-240">Ordre Size:</div>
                        </div>
                        <div class="div-block-412">
                          <input class="text-field-10 w-node-_655bec7b-eaf2-c952-5d89-dbca9e08e7c6-1f521c30 w-input" id="limit_size" onchange="updateLimitOrderCalculations()"  />
                          <div id="w-node-_655bec7b-eaf2-c952-5d89-dbca9e08e7c7-1f521c30" class="text-block-237">USDT</div>
                          <div class="div-block-468">
                            <a href="#" class="button-103 w-button" onclick="incrementNum('limit_size',1)">△</a>
                            <a href="#" class="button-104 w-button" onclick="incrementNum('limit_size',-1)">▽ <br />
                            </a>
                          </div>
                        </div>
                        <div class="div-block-471">
                            <a id="w-node-_655bec7b-eaf2-c952-5d89-dbca9e08e7ba-1f521c30" href="#" class="button-97 w-button" onclick="applyPctOfBalance(25)">25 %</a>
                            <a id="w-node-_655bec7b-eaf2-c952-5d89-dbca9e08e7bc-1f521c30" href="#" class="button-97 w-button" onclick="applyPctOfBalance(50)">50 %</a>
                            <a id="w-node-_655bec7b-eaf2-c952-5d89-dbca9e08e7be-1f521c30" href="#" class="button-97 w-button" onclick="applyPctOfBalance(75)">75 %</a>
                            <a id="w-node-_655bec7b-eaf2-c952-5d89-dbca9e08e7c0-1f521c30" href="#" class="button-98 w-button" onclick="applyPctOfBalance(100)">100 %</a>
                          </div>
                        <div class="div-block-481">
                          <div class="text-block-226">Leverage :</div>
                        </div>
                        <div class="div-block-484">
                          <a href="#" class="button-109 w-button">
                            <strong class="bold-text-16" onclick="setLeverage('limit_leverage',1)">×1</strong>
                          </a>
                          <a href="#" class="button-109 w-button">
                            <strong class="bold-text-2" onclick="setLeverage('limit_leverage',5)">×5</strong>
                          </a>
                          <a href="#" class="button-109 w-button">
                            <strong class="bold-text-4" onclick="setLeverage('limit_leverage',10)">×10</strong>
                          </a>
                          <a href="#" class="button-109 w-button">
                            <strong class="bold-text-4" onclick="setLeverage('limit_leverage',25)">×25</strong>
                          </a>
                          <input class="text-field-16 w-node-_655bec7b-eaf2-c952-5d89-dbca9e08e7df-1f521c30 w-input" id="limit_leverage" placeholder="5" value="5" onchange="updateLimitOrderCalculations()" />
                          <div class="div-block-468">
                            <a href="#" class="button-103 w-button" onclick="incrementLeverage('limit_leverage',1)">△</a>
                            <a href="#" class="button-104 w-button" onclick="incrementLeverage('limit_leverage',-1)">▽ <br />
                            </a>
                          </div>
                        </div>
                        <div class="take-profit">
                          <div data-w-id="655bec7b-eaf2-c952-5d89-dbca9e08e7e7" class="rl_faq6_question-3">
                            <a href="#" class="button-100 w-button" onclick="toggleSLTP()">Take Profit</a>
                            <div class="rl_faq6_icon-wrapper-3">
                              <div class="rl_faq6_icon-3 w-embed">
                                <svg width=" 100%" height=" 100%" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M25.3334 15.6668V16.3334C25.3334 16.7016 25.0349 17.0001 24.6667 17.0001H17.0001V24.6667C17.0001 25.0349 16.7016 25.3334 16.3334 25.3334H15.6667C15.2986 25.3334 15.0001 25.0349 15.0001 24.6667L15.0001 17.0001H7.33341C6.96522 17.0001 6.66675 16.7016 6.66675 16.3334V15.6668C6.66675 15.2986 6.96522 15.0001 7.33341 15.0001H15.0001V7.33341C15.0001 6.96522 15.2986 6.66675 15.6667 6.66675H16.3334C16.7016 6.66675 17.0001 6.96522 17.0001 7.33341V15.0001L24.6667 15.0001C25.0349 15.0001 25.3334 15.2986 25.3334 15.6668Z" fill="currentColor" />
                                </svg>
                              </div>
                            </div>
                          </div>
                          <div style="width:100%;height:0px" class="rl_faq6_answer-2">
                            <div class="rl_faq6_answer-wrapper-2">
                              <div class="div-block-464"></div>
                            </div>
                            <div class="div-block-489">
                              <input class="text-field-17 w-input" id="limit_tp" placeholder="ex: 2800.00" onchange="limitOnTpPriceChange()" />
                              <div class="text-block-237">USDT</div>
                              <div class="div-block-468">
                                <a href="#" class="button-103 w-button" onclick="incrementNum('limit_tp',1)">△</a>
                                <a href="#" class="button-104 w-button" onclick="incrementNum('limit_tp',-1)">▽ <br />
                                </a>
                              </div>
                            </div>
                            <div class="div-block-489">
                              <input class="text-field-17 w-input" id="limit_tpProfitUsd" placeholder="30" onchange="limitOnTpProfitUsdChange()"/>
                              <div class="text-block-237">Price</div>
                              <div class="div-block-468">
                                <a href="#" class="button-103 w-button" onclick="incrementNum('limit_tpProfitUsd',1)">△</a>
                                <a href="#" class="button-104 w-button" onclick="incrementNum('limit_tpProfitUsd',-1)">▽ <br />
                                </a>
                              </div>
                            </div>
                            <div class="div-block-489">
                              <input class="text-field-17 w-input" id="limit_tpProfitPct" placeholder="10" onchange="limitOnTpProfitPctChange()"/>
                              <div class="text-block-237">%</div>
                              <div class="div-block-468">
                                <a href="#" class="button-103 w-button" onclick="incrementNum('limit_tpProfitPct',1)">△</a>
                                <a href="#" class="button-104 w-button" onclick="incrementNum('limit_tpProfitPct',-1)">▽ <br />
                                </a>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="take-profit">
                          <div data-w-id="655bec7b-eaf2-c952-5d89-dbca9e08e80e" class="rl_faq6_question-3">
                            <a href="#" class="button-100 w-button" onclick="toggleSLTP()">Stop Loss</a>
                            <div class="rl_faq6_icon-wrapper-3">
                              <div class="rl_faq6_icon-3 w-embed">
                                <svg width=" 100%" height=" 100%" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M25.3334 15.6668V16.3334C25.3334 16.7016 25.0349 17.0001 24.6667 17.0001H17.0001V24.6667C17.0001 25.0349 16.7016 25.3334 16.3334 25.3334H15.6667C15.2986 25.3334 15.0001 25.0349 15.0001 24.6667L15.0001 17.0001H7.33341C6.96522 17.0001 6.66675 16.7016 6.66675 16.3334V15.6668C6.66675 15.2986 6.96522 15.0001 7.33341 15.0001H15.0001V7.33341C15.0001 6.96522 15.2986 6.66675 15.6667 6.66675H16.3334C16.7016 6.66675 17.0001 6.96522 17.0001 7.33341V15.0001L24.6667 15.0001C25.0349 15.0001 25.3334 15.2986 25.3334 15.6668Z" fill="currentColor" />
                                </svg>
                              </div>
                            </div>
                          </div>
                          <div style="width:100%;height:0px" class="rl_faq6_answer-2">
                            <div class="rl_faq6_answer-wrapper-2">
                              <div class="div-block-464"></div>
                            </div>
                            <div class="div-block-489">
                              <input class="text-field-17 w-input" id="limit_sl" placeholder="ex: 2600.00" onchange="limitOnSlPriceChange()" />
                              <div class="text-block-237">USDT</div>
                              <div class="div-block-468">
                                <a href="#" class="button-103 w-button" onclick="incrementNum('limit_sl',1)">△</a>
                                <a href="#" class="button-104 w-button" onclick="incrementNum('limit_sl',-1)">▽ <br />
                                </a>
                              </div>
                            </div>
                            <div class="div-block-489">
                              <input class="text-field-17 w-input" id="limit_slProfitUsd" placeholder="10" onchange="limitOnSlProfitUsdChange()" />
                              <div class="text-block-237">Price</div>
                              <div class="div-block-468">
                                <a href="#" class="button-103 w-button" onclick="incrementNum('limit_slProfitUsd',1)">△</a>
                                <a href="#" class="button-104 w-button" onclick="incrementNum('limit_slProfitUsd',-1)">▽ <br />
                                </a>
                              </div>
                            </div>
                            <div class="div-block-489">
                              <input class="text-field-17 w-input" id="limit_slProfitPct" placeholder="10" onchange="limitOnSlProfitPctChange()" />
                              <div class="text-block-237">%</div>
                              <div class="div-block-468">
                                <a href="#" class="button-103 w-button" onclick="incrementNum('limit_slProfitPct',1)">△</a>
                                <a href="#" class="button-104 w-button" onclick="incrementNum('limit_slProfitPct',-1)">▽ <br />
                                </a>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="div-block-485">
                          <div class="div-block-465">
                            <div class="text-block-222">Entry Price : </div>
                            <div id="w-node-_655bec7b-eaf2-c952-5d89-dbca9e08e838-1f521c30" class="text-block-228">USDT</div>
                          </div>
                          <div class="div-block-465">
                            <div class="text-block-222">Size in USDT : </div>
                            <div class="text-block-228">USDT</div>
                          </div>
                          <div class="div-block-465">
                            <div id="w-node-_655bec7b-eaf2-c952-5d89-dbca9e08e840-1f521c30" class="text-block-222">Fee in ETH : </div>
                            <div class="text-block-228">ETH</div>
                          </div>
                          <div class="div-block-465">
                            <div id="w-node-_655bec7b-eaf2-c952-5d89-dbca9e08e845-1f521c30" class="text-block-222">Liquidation Price: </div>
                            <div class="text-block-228"><div id="orderInfo"></div>USDC</div>
                          </div>
                        </div>
                    </div>
                    <a href="#" class="button-99 w-button" onclick="openLimitAction()">Execute the order →</a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
        <section class="position">
          <div class="div-block-515">
            <div class="div-block-512"></div>
            <div class="div-block-511">
              <div class="div-block-520">
                <div class="div-block-509"></div>
                <div class="div-block-509"></div>
                <div class="div-block-525">
                  <div>
                    <div class="text-block-266" id="wallet-address">Please connect your wallet</div>
                  </div>
                  <div class="div-block-516">
                    <div class="div-block-505">
                      <div class="text-block-255" id="latency-result" >...</div>
                      <div class="text-block-255">ms</div>
                    </div>
                    <div class="div-block-505">
                      <div class="text-block-255" id="speed-result">...</div>
                      <div class="text-block-255">Mbps</div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="div-block-501">
                <div class="div-block-510">
                    <a data-w-id="f5a3995e-64f5-4116-b75b-7e0efaf72c19" href="#" class="button-111 w-button">Open(<span id="openPositionsCount">0</span>)</a>
                    <a data-w-id="f5a3995e-64f5-4116-b75b-7e0efaf72c1b" href="#" class="button-111 w-button">Order(<span id="limitOrdersCount">0</span>)</a>
                    <a data-w-id="f5a3995e-64f5-4116-b75b-7e0efaf72c1d" href="#" class="button-111 w-button">History(<span id="closedPositionsCount">0</span>)</a>
                  <div class="div-block-504"></div>
                </div>
              </div>
              <div class="open-2">
                <div id="openPositionsContainer" >
                    <!-- Le contenu des positions ouvertes sera injecté ici -->
                  </div>
                  
                 
              </div>
              <div class="history">
                <div class="div-block-522">
                  <div class="text-block-262">Pair</div>
                  <div class="text-block-262">Type</div>
                  <div class="text-block-262">Size(USDT)</div>
                  <div class="text-block-262">Entery Price</div>
                  <div class="text-block-262">Close price</div>
                  <div class="text-block-262">Leverage</div>
                  <div id="w-node-f5a3995e-64f5-4116-b75b-7e0efaf72ca8-1f521c30" class="text-block-262">Profit</div>
                </div>
                <div id="closedPositionsContainer" >
                    <!-- Le contenu des positions fermées sera injecté ici -->
                 </div>
                
              </div>
              <div class="neworderblock">
                <div class="div-block-513">
                  <div data-w-id="5b4ba379-68e8-b4dc-8aa4-ef5b6df7b5bd" class="text-block-256">Pair</div>
                  <div data-w-id="5b4ba379-68e8-b4dc-8aa4-ef5b6df7b5bf" class="text-block-256">Type</div>
                  <div data-w-id="5b4ba379-68e8-b4dc-8aa4-ef5b6df7b5c1" class="text-block-256">Entry Price </div>
                  <div data-w-id="5b4ba379-68e8-b4dc-8aa4-ef5b6df7b5c3" class="text-block-256">Market Price</div>
                  <div data-w-id="5b4ba379-68e8-b4dc-8aa4-ef5b6df7b5c5" class="text-block-256">Size (USDT)</div>
                  <div data-w-id="5b4ba379-68e8-b4dc-8aa4-ef5b6df7b5c7" class="text-block-256">Price</div>
                  <div data-w-id="5b4ba379-68e8-b4dc-8aa4-ef5b6df7b5c9" class="text-block-256">Leverage</div>
                  <div id="w-node-_5b4ba379-68e8-b4dc-8aa4-ef5b6df7b5cb-1f521c30" data-w-id="5b4ba379-68e8-b4dc-8aa4-ef5b6df7b5cb" class="text-block-256">Status</div>
                </div>
                <div id="limitOrdersContainer" >
                    <!-- Le contenu des ordres limites sera injecté ici -->
                  </div>
               
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>
    <script src="js/jquery.js" type="text/javascript"></script>
    <script src="js/webflow.schunk.4a394eb5af8156f2.js" type="text/javascript"></script>
    <script src="js/webflow-script.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.6.9/dist/ethers.umd.min.js"></script>
    <script>
        (function(){
          /***********************
           * VARIABLES ET FONCTIONS COMMUNES
           ***********************/
          // Liste des feeds avec feedId, symbole et catégorie (pour le graphique, on utilise le feedId et le symbole)
          const assets = {
            "AAPL": { feedId: "0x49f6b65cb1de6b10eaf75e7c03ca029c306d0357e91b5311b175084a5ad55688", symbol: "Equity.US.AAPL/USD", category:"stock" },
            "AMZN": { feedId: "0xb5d0e0fa58a1f8b81498ae670ce93c872d14434b72c364885d4fa1b257cbb07a", symbol: "Equity.US.AMZN/USD", category:"stock" },
            "COIN": { feedId: "0xfee33f2a978bf32dd6b662b65ba8083c6773b494f8401194ec1870c640860245", symbol: "Equity.US.COIN/USD", category:"stock" },
            "GOOG": { feedId: "0xe65ff435be42630439c96396653a342829e877e2aafaeaf1a10d0ee5fd2cf3f2", symbol: "Equity.US.GOOG/USD", category:"stock" },
            "GME": { feedId: "0x6f9cd89ef1b7fd39f667101a91ad578b6c6ace4579d5f7f285a4b06aa4504be6", symbol: "Equity.US.GME/USD", category:"stock" },
            "INTC": { feedId: "0xc1751e085ee292b8b3b9dd122a135614485a201c35dfc653553f0e28c1baf3ff", symbol:"Equity.US.INTC/USD", category:"stock" },
            "KO": { feedId: "0x9aa471dccea36b90703325225ac76189baf7e0cc286b8843de1de4f31f9caa7d", symbol:"Equity.US.KO/USD", category:"stock" },
            "MCD": { feedId: "0xd3178156b7c0f6ce10d6da7d347952a672467b51708baaf1a57ffe1fb005824a", symbol:"Equity.US.MCD/USD", category:"stock" },
            "MSFT": { feedId: "0xd0ca23c1cc005e004ccf1db5bf76aeb6a49218f43dac3d4b275e92de12ded4d1", symbol:"Equity.US.MSFT/USD", category:"stock" },
            "NKE": { feedId: "0x67649450b4ca4bfff97cbaf96d2fd9e40f6db148cb65999140154415e4378e14", symbol:"Equity.US.NKE/USD", category:"stock" },
            "NVDA": { feedId: "0x78a3e3b8e676a8f73c439f5d749737034b139bbbe899ba5775216fba596607fe", symbol:"Equity.US.NVDA/USD", category:"stock" },
            "FB": { feedId: "0xb1073854ed24cbc755dc527418f52b7d271f6cc967bbf8d8129112b18860a593", symbol:"Equity.US.META/USD", category:"stock" },
            "TSLA": { feedId: "0x16dad506d7db8da01c87581c87ca897a012a153557d4d578c3b9c9e1bc0632f1", symbol:"Equity.US.TSLA/USD", category:"stock" },
            "AUDUSD": { feedId: "0x67a6f93030420c1c9e3fe37c1ab6b77966af82f995944a9fefce357a22854a80", symbol:"FX.AUD/USD", category:"forex" },
            "EURUSD": { feedId: "0xa995d00bb36a63cef7fd2c287dc105fc8f3d93779f062f09551b0af3e81ec30b", symbol:"FX.EUR/USD", category:"forex" },
            "GBPUSD": { feedId: "0x84c2dde9633d93d1bcad84e7dc41c9d56578b7ec52fabedc1f335d673df0a7c1", symbol:"FX.GBP/USD", category:"forex" },
            "NZDUSD": { feedId: "0x92eea8ba1b00078cdc2ef6f64f091f262e8c7d0576ee4677572f314ebfafa4c7", symbol:"FX.NZD/USD", category:"forex" },
            "USDCAD": { feedId: "0x3112b03a41c910ed446852aacf67118cb1bec67b2cd0b9a214c58cc0eaa2ecca", symbol:"FX.USD/CAD", category:"forex" },
            "USDCHF": { feedId: "0x0b1e3297e69f162877b577b0d6a47a0d63b2392bc8499e6540da4187a63e28f8", symbol:"FX.USD/CHF", category:"forex" },
            "JPY": { feedId: "0xef2c98c804ba503c6a707e38be4dfbb16683775f195b091252bf24693042fd52", symbol:"FX.USD/JPY", category:"forex" },
            "XAUUSD": { feedId: "0xf2fb02c32b055c805e7238d628e5e9dadef274376114eb1f012337cabe93871e", symbol:"Metal.XAU/USD", category:"metal" },
            "XAGUSD": { feedId: "0x765d2ba906dbc32ca17cc11f5310a89e9ee1f6420508c63861f2f8ba4ee34bb2", symbol:"Metal.XAG/USD", category:"metal" }
          };
          
          // VARIABLES POUR LE GRAPHIQUE ET STREAMING
          let currentAsset = assets["AAPL"];
          let priceEventSource = null;
          let chartStreamController = null;
          let chart, candleSeries, lineSeries;
          let currentCandle = null;
          let isChartStreaming = false;
          let showCandles = true;
          let currentResolution = '5';
          
          // VARIABLES POUR LE TRADING / FLUX PYTH
          let currentFeedId = currentAsset.feedId;
          let currentFeedCategory = currentAsset.category;
          let eventSource;
          
          // VARIABLES TRADING
          let latestPriceUpdate = [];
          let pythExpo = 0;
          let currentMarketPrice = 0;
          let signer, contract;
          let isShortGlobal = false;
          let isSlTpActive = false;
          
          // VARIABLE POUR LE THEME (Sombre par défaut)
          let isDarkTheme = true;
          
          /********* FONCTIONS DE FORMATTAGE *********/
          function formatPrice(value, expo) {
            return Number(value) * Math.pow(10, expo);
          }
          function dynamicFormat(num) {
            return num.toFixed(getDecimalPlaces(num));
          }
          function getDecimalPlaces(num) {
            const intPart = Math.floor(Math.abs(num)).toString();
            return (intPart.length >= 3) ? 2 : 4;
          }
          
          /********* FONCTIONS POUR LE GRAPHIQUE ET STREAMING *********/
          function initPriceStream(asset) {
            if (priceEventSource) priceEventSource.close();
            const streamUrl = `https://hermes.pyth.network/v2/updates/price/stream?ids[]=${asset.feedId}`;
            priceEventSource = new EventSource(streamUrl);
            priceEventSource.onmessage = e => {
              try {
                const data = JSON.parse(e.data);
                updatePriceDisplay(data);
              } catch (error) { console.error('Erreur parsing stream :', error); }
            };
            priceEventSource.onerror = err => console.error('Erreur connexion stream:', err);
          }
          function updatePriceDisplay(data) {
            const parsed = data.parsed[0];
            const basePrice = formatPrice(parsed.price.price, parsed.price.expo);
            const conf = formatPrice(parsed.price.conf, parsed.price.expo);
            const plusPrice = basePrice + conf;
            const minusPrice = basePrice - conf;
            document.getElementById('price').innerText = basePrice < 10 ? basePrice.toFixed(4) : basePrice.toFixed(2);
            document.getElementById('price-plus').innerText = plusPrice < 10 ? plusPrice.toFixed(4) : plusPrice.toFixed(2);
            document.getElementById('price-minus').innerText = minusPrice < 10 ? minusPrice.toFixed(4) : minusPrice.toFixed(2);
          }
          async function updateInfo(asset) {
            const url = `https://benchmarks.pyth.network/v1/price_feeds/${asset.feedId}`;
            try {
              const response = await fetch(url);
              const data = await response.json();
              document.getElementById('base').innerText = `${data.attributes.base}`;
              document.getElementById('description').innerText = `${data.attributes.description}`;
              document.getElementById('display_symbol').innerText = `${data.attributes.display_symbol}`;
              const marketStatus = data.market_hours && data.market_hours.is_open ? "Open" : "Close";
              document.getElementById('market_status').innerText = `${marketStatus}`;
            } catch (error) { console.error('Erreur infos feed :', error); }
          }
          function updateHistorical(asset) {
            const to = Math.floor(Date.now()/1000);
            const from = to - (3 * 24 * 60 * 60);
            const url = `https://benchmarks.pyth.network/v1/shims/tradingview/history?symbol=${asset.symbol}&resolution=D&from=${from}&to=${to}`;
            fetch(url)
              .then(response => response.json())
              .then(data => {
                if(data.s==="ok" && data.o.length > 0) {
                  function formatNumber(num) {
                    return num.toString().split('.')[0].length>=2 ? Number(num).toFixed(2) : Number(num).toFixed(4);
                  }
                  document.getElementById('o').innerText = formatNumber(data.o[data.o.length-1]);
                  document.getElementById('h').innerText = formatNumber(data.h[data.h.length-1]);
                  document.getElementById('l').innerText = formatNumber(data.l[data.l.length-1]);
                  document.getElementById('c').innerText = formatNumber(data.c[data.c.length-1]);
                }
              })
              .catch(error => console.error('Erreur historique :', error));
          }
          
          // Fonction initChart avec changement de thème et mise à jour des champs OHLC
          async function initChart() {
            if(chart) chart.remove();
            
            // Options de configuration du graphique selon le thème choisi
            const themeOptions = isDarkTheme ? {
              layout: { textColor: 'rgba(255,255,255,0.8)', background: { type:'solid', color:'#000' }, fontFamily: "'Source Code Pro', monospace" },
              grid: { vertLines: { color:'rgba(255,255,255,0.1)' }, horzLines: { color:'rgba(255,255,255,0.1)' } },
              timeScale: { timeVisible: true, secondsVisible: false, barSpacing: 15 }
            } : {
              layout: { textColor: 'rgba(0,0,0,0.8)', background: { type:'solid', color:'#fff' }, fontFamily: "'Source Code Pro', monospace" },
              grid: { vertLines: { color:'rgba(0,0,0,0.1)' }, horzLines: { color:'rgba(0,0,0,0.1)' } },
              timeScale: { timeVisible: true, secondsVisible: false, barSpacing: 15 }
            };
            
            chart = LightweightCharts.createChart(document.getElementById('chartContainer'), themeOptions);
            
            chart.priceScale('right').applyOptions({
              autoScale: true, scaleMargins: { top: 0.1, bottom: 0.2 },
              tickMarkFormatter: price => price < 10 ? price.toFixed(4) : price.toFixed(2)
            });
            
            candleSeries = chart.addCandlestickSeries({
              upColor: '#2196F3', downColor: '#ef5350', borderVisible: true,
              wickUpColor: '#2196F3', wickDownColor: '#ef5350',
              priceFormat: { type: 'price', precision: 4, minMove: 0.001 }
            });
            lineSeries = chart.addLineSeries({
              color: '#ffffff', lineWidth: 2, visible: false,
              priceFormat: { type: 'price', precision: 4, minMove: 0.001 }
            });
            await loadHistoricalChartData();
            startChartStreaming();
            // Ajout d'un appel pour mettre à jour les champs OHLC
            updateHistorical(currentAsset);
          }
          
          async function loadHistoricalChartData() {
            let days;
            switch(currentResolution) {
              case '1': days=4; break;
              case '5': days=30; break;
              case '15': days=60; break;
              case '60': days=365; break;
              case '240': days=365; break;
              case 'D': days=365; break;
              default: days=7;
            }
            const from = Math.floor(Date.now()/1000 - (days*24*60*60));
            const to = Math.floor(Date.now()/1000);
            const url = `https://benchmarks.pyth.network/v1/shims/tradingview/history?symbol=${currentAsset.symbol}&resolution=${currentResolution}&from=${from}&to=${to}`;
            try {
              const response = await fetch(url);
              const data = await response.json();
              if(data.s !== "ok" || !data.t) throw new Error("Réponse API invalide");
              const formattedData = data.t.map((t,i)=>({ time: t, open: data.o[i], high: data.h[i], low: data.l[i], close: data.c[i] }));
              candleSeries.setData(formattedData);
              lineSeries.setData(formattedData.map(d=>({ time: d.time, value: d.close })));
              if(formattedData.length>100) {
                chart.timeScale().setVisibleLogicalRange({ from: formattedData.length-100, to: formattedData.length });
              } else {
                chart.timeScale().fitContent();
              }
              currentCandle = formattedData.length>0 ? formattedData[formattedData.length-1] : null;
            } catch(error) { console.error('Erreur chargement graphique :', error); alert('Erreur de chargement du graphique'); }
          }
          
          async function startChartStreaming() {
            if(isChartStreaming) return;
            isChartStreaming = true;
            if(chartStreamController) chartStreamController.abort();
            chartStreamController = new AbortController();
            const signal = chartStreamController.signal;
            try {
              const response = await fetch('https://benchmarks.pyth.network/v1/shims/tradingview/streaming', { signal });
              const reader = response.body.getReader();
              const decoder = new TextDecoder();
              let buffer = '';
              while(true) {
                const { done, value } = await reader.read();
                if(done) break;
                buffer += decoder.decode(value);
                const lines = buffer.split('\n');
                buffer = lines.pop() || '';
                for(const line of lines) {
                  if(!line.trim()) continue;
                  try {
                    const data = JSON.parse(line);
                    if(data.id === currentAsset.symbol && data.p) processNewChartPrice(parseFloat(data.p));
                  } catch(e) { console.error('Erreur parsing streaming graphique :', e); }
                }
              }
            } catch(error) {
              console.error('Erreur streaming graphique :', error);
              setTimeout(startChartStreaming,5000);
            } finally { isChartStreaming = false; }
          }
          
          function processNewChartPrice(price) {
            const timestamp = Math.floor(Date.now()/1000);
            const candleDuration = currentResolution === 'D' ? 86400 : currentResolution * 60;
            const candleStart = Math.floor(timestamp/candleDuration)*candleDuration;
            if(!currentCandle || currentCandle.time !== candleStart) {
              if(currentCandle) candleSeries.update(currentCandle);
              currentCandle = { time: candleStart, open: currentCandle ? currentCandle.close : price, high: price, low: price, close: price };
            } else {
              currentCandle.close = price;
              currentCandle.high = Math.max(currentCandle.high, price);
              currentCandle.low = Math.min(currentCandle.low, price);
            }
            candleSeries.update(currentCandle);
            lineSeries.update({ time: currentCandle.time, value: price });
          }
          
          /********* FONCTIONS POUR LE TRADING / PYTH FLUX *********/
          function initEventSource() {
            if(eventSource) eventSource.close();
            const newAPIUrl = "https://hermes.pyth.network/v2/updates/price/stream?ids[]=" + currentFeedId;
            eventSource = new EventSource(newAPIUrl);
            eventSource.onmessage = e => {
              try { const data = JSON.parse(e.data); updateDisplay(data); }
              catch(err){ console.error("Erreur parse data:",err); }
            };
            eventSource.onerror = () => {
              document.getElementById('live-data').innerHTML = `<div class="data-box" style="color:#f44;">Erreur de connexion au flux Pyth - reconnexion...</div>`;
            };
          }
          function updateDisplay(data) {
            const parsed = data.parsed[0];
            const binary = data.binary;
            if(!parsed || !binary) return;
            latestPriceUpdate = binary.data.map(d => "0x" + d);
            pythExpo = parseInt(parsed.price.expo,10);
            const priceNum = formatPrice(parsed.price.price, parsed.price.expo);
            const confNum = formatPrice(parsed.price.conf, parsed.price.expo);
            currentMarketPrice = priceNum;
            const formattedPrice = dynamicFormat(priceNum);
            const formattedConf = dynamicFormat(confNum);
            const pricePlusConf = dynamicFormat(priceNum+confNum);
            const priceMinusConf = dynamicFormat(priceNum-confNum);
            const pubTime = parsed.price.publish_time;
            const slot = parsed.metadata.slot;
            if(document.getElementById('limit_targetPrice').value==="") {
              document.getElementById('limit_targetPrice').value = dynamicFormat(currentMarketPrice);
            }
            const html = `
              <div class="data-box">
                <div class="price-info">
                  <div>Price: ${formattedPrice}</div>
                  <div>Confidence: ±${formattedConf}</div>
                  <div>Price + Conf: ${pricePlusConf}</div>
                  <div>Price – Conf: ${priceMinusConf}</div>
                </div>
                <div class="hex-data">
                  RAW: [${latestPriceUpdate.join(", ")}]
                </div>
                <div class="timestamp">
                  Publ. time: ${new Date(pubTime*1000).toLocaleString()} (Slot: ${slot}), expo: ${pythExpo}
                </div>
              </div>
            `;
            document.getElementById('live-data').innerHTML = html;
            updateLiquidationPrice();
          }
          function updateLiquidationPrice() {
            const lev = parseFloat(document.getElementById('pos_leverage').value)||1;
            if(currentMarketPrice<=0 || lev<=0) return;
            let liq = !isShortGlobal ? currentMarketPrice*(1-1/lev) : currentMarketPrice*(1+1/lev);
            document.getElementById('orderInfo').innerHTML =  dynamicFormat(liq);
          }
          
          /********* FONCTIONS POUR LE WALLET ET ALLOWANCE *********/
          const usdcContractAddr = "0x95CA2454a71EA272fFE543aF297fDcd877E42605";
          const usdcAbi = [
            {
              "inputs": [{"internalType": "address", "name": "account", "type": "address"}],
              "name": "balanceOf",
              "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
              "stateMutability": "view", "type": "function"
            },
            {
              "inputs": [
                {"internalType": "address", "name": "owner", "type": "address"},
                {"internalType": "address", "name": "spender", "type": "address"}
              ],
              "name": "allowance",
              "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
              "stateMutability": "view", "type": "function"
            },
            {
              "inputs": [
                {"internalType": "address", "name": "spender", "type": "address"},
                {"internalType": "uint256", "name": "value", "type": "uint256"}
              ],
              "name": "increaseAllowance",
              "outputs": [{"internalType": "bool", "name": "", "type": "bool"}],
              "stateMutability": "nonpayable", "type": "function"
            }
          ];
          const fixedSpender = "0xAc51dD5ad45DC78661646F1E62aA0E8C60aF086B";
          const hugeAllowance = ethers.constants.MaxUint256;
          
          async function checkNetwork() {
            const provider = new ethers.providers.Web3Provider(window.ethereum);
            const network = await provider.getNetwork();
            if(network.chainId!==43113) {
              try {
                await window.ethereum.request({ method:'wallet_switchEthereumChain', params:[{chainId:"0xA869"}] });
                return true;
              } catch(switchError) {
                if(switchError.code===4902) {
                  try {
                    await window.ethereum.request({
                      method: 'wallet_addEthereumChain',
                      params: [{
                        chainId: "0xA869",
                        chainName: "Avalanche FUJI C-Chain",
                        nativeCurrency: { name: "Avalanche", symbol: "AVAX", decimals: 18 },
                        rpcUrls: ["https://api.avax-test.network/ext/bc/C/rpc"],
                        blockExplorerUrls: ["https://testnet.snowscan.io/"]
                      }]
                    });
                    return true;
                  } catch(addError) { console.error("Erreur ajout réseau :",addError); return false; }
                } else { console.error("Erreur changement réseau :",switchError); return false; }
              }
            }
            return true;
          }
          
          async function checkAndIncreaseAllowanceIfNeeded() {
            const provider = new ethers.providers.Web3Provider(window.ethereum);
            const signerLocal = provider.getSigner();
            const userAddress = await signerLocal.getAddress();
            const usdcContract = new ethers.Contract(usdcContractAddr, usdcAbi, signerLocal);
            const currentAllowance = await usdcContract.allowance(userAddress, fixedSpender);
            if(currentAllowance.lt(hugeAllowance)) {
              const networkOk = await checkNetwork();
              if(!networkOk) throw new Error("Réseau incorrect, veuillez changer de réseau.");
              const difference = hugeAllowance.sub(currentAllowance);
              const tx = await usdcContract.increaseAllowance(fixedSpender, difference);
              showNotification("Allowance insuffisante. Augmentation en cours : <a href='https://testnet.snowscan.xyz/tx/" + tx.hash + "' target='_blank'>" + tx.hash + "</a>");
              await tx.wait();
              showNotification("Allowance mise à jour avec succès !");
            }
          }
          
          async function updateWalletBalance() {
            const provider = new ethers.providers.Web3Provider(window.ethereum);
            const signerLocal = provider.getSigner();
            const userAddress = await signerLocal.getAddress();
            const usdcContract = new ethers.Contract(usdcContractAddr, usdcAbi, signerLocal);
            const rawBalance = await usdcContract.balanceOf(userAddress);
            const balanceFloat = parseFloat(ethers.utils.formatUnits(rawBalance,6));
            document.getElementById('walletBalance').textContent =  balanceFloat.toFixed(2);
          }
          
          async function connectWallet() {
            try {
              if(!window.ethereum){ alert("MetaMask non détecté !"); return; }
              const accounts = await window.ethereum.request({ method:'eth_requestAccounts' });
              const userAddress = accounts[0];
              document.getElementById('walletAddress').textContent =  userAddress;
              const provider = new ethers.providers.Web3Provider(window.ethereum);
              signer = provider.getSigner();
              // Initialiser le contrat
              const contractAddress = "0xAc51dD5ad45DC78661646F1E62aA0E8C60aF086B";
              const contractABI = [
                {
                  "inputs": [
                    {"internalType": "bytes32", "name": "priceFeedId", "type": "bytes32"},
                    {"internalType": "bytes[]", "name": "priceUpdate", "type": "bytes[]"},
                    {"internalType": "uint256", "name": "size", "type": "uint256"},
                    {"internalType": "bool", "name": "isShort", "type": "bool"},
                    {"internalType": "uint256", "name": "leverage", "type": "uint256"}
                  ],
                  "name": "openPosition",
                  "outputs": [],
                  "stateMutability": "payable",
                  "type": "function"
                },
                {
                  "inputs": [
                    {"internalType": "bytes32", "name": "priceFeedId", "type": "bytes32"},
                    {"internalType": "bytes[]", "name": "priceUpdate", "type": "bytes[]"},
                    {"internalType": "uint256", "name": "size", "type": "uint256"},
                    {"internalType": "bool", "name": "isShort", "type": "bool"},
                    {"internalType": "uint256", "name": "leverage", "type": "uint256"},
                    {"internalType": "int256", "name": "sl", "type": "int256"},
                    {"internalType": "int256", "name": "tp", "type": "int256"}
                  ],
                  "name": "openPositionWithSlTp",
                  "outputs": [],
                  "stateMutability": "payable",
                  "type": "function"
                },
                {
                  "inputs": [
                    {"internalType": "bytes32", "name": "priceFeedId", "type": "bytes32"},
                    {"internalType": "uint256", "name": "size", "type": "uint256"},
                    {"internalType": "bool", "name": "isShort", "type": "bool"},
                    {"internalType": "uint256", "name": "leverage", "type": "uint256"},
                    {"internalType": "int256", "name": "targetPrice", "type": "int256"}
                  ],
                  "name": "openLimitOrder",
                  "outputs": [],
                  "stateMutability": "nonpayable",
                  "type": "function"
                },
                {
                  "inputs": [
                    {"internalType": "bytes32", "name": "priceFeedId", "type": "bytes32"},
                    {"internalType": "uint256", "name": "size", "type": "uint256"},
                    {"internalType": "bool", "name": "isShort", "type": "bool"},
                    {"internalType": "uint256", "name": "leverage", "type": "uint256"},
                    {"internalType": "int256", "name": "targetPrice", "type": "int256"},
                    {"internalType": "int256", "name": "sl", "type": "int256"},
                    {"internalType": "int256", "name": "tp", "type": "int256"}
                  ],
                  "name": "openLimitOrderWithSlTp",
                  "outputs": [],
                  "stateMutability": "nonpayable",
                  "type": "function"
                }
              ];
              contract = new ethers.Contract(contractAddress, contractABI, signer);
              await updateWalletBalance();
              // Définir la taille par défaut (25% du solde)
              const balanceFloat = parseFloat(ethers.utils.formatUnits((await (new ethers.Contract(usdcContractAddr, usdcAbi, signer)).balanceOf(userAddress)),6));
              const defaultSize = balanceFloat * 0.25;
              document.getElementById('limit_size').value = defaultSize.toFixed(2);
              document.getElementById('pos_size').value = defaultSize.toFixed(2);
              // Réinitialiser SL/TP pour le Limit Order
              document.getElementById('limit_sl').value = "";
              document.getElementById('limit_tp').value = "";
              document.getElementById('limit_slProfitUsd').value = "";
              document.getElementById('limit_slProfitPct').value = "";
              document.getElementById('limit_tpProfitUsd').value = "";
              document.getElementById('limit_tpProfitPct').value = "";
              setMessage("Connexion réussie. Solde USDC: " + balanceFloat.toFixed(2));
            } catch(err) { setError("Erreur connexion MetaMask : " + err.message); }
          }
          
          function setIsShortValue(val) {
            isShortGlobal = val;
            document.getElementById('isShortIndicator').textContent = "isShort actuel : " + isShortGlobal;
            updateLiquidationPrice();
            document.getElementById('limit_sl').value = "";
            document.getElementById('limit_tp').value = "";
            document.getElementById('limit_slProfitUsd').value = "";
            document.getElementById('limit_slProfitPct').value = "";
            document.getElementById('limit_tpProfitUsd').value = "";
            document.getElementById('limit_tpProfitPct').value = "";
            document.getElementById('pos_sl').value = "";
            document.getElementById('pos_tp').value = "";
          }
          
          function setMessage(msg) {
            document.getElementById('message').textContent = msg;
            document.getElementById('error').textContent = '';
          }
          function setError(msg) {
            document.getElementById('error').textContent = msg;
            document.getElementById('message').textContent = '';
          }
          function showNotification(message, isError=false) {
            const notif = document.getElementById('notification');
            notif.innerHTML = message;
            notif.style.backgroundColor = isError ? '#f44336' : '#4CAF50';
            notif.style.display = 'block';
            setTimeout(()=>{ notif.style.display = 'none'; },5000);
          }
          
          function parseUSDC(valueString) {
            try { return ethers.utils.parseUnits(valueString,6); }
            catch(e) { console.error("Erreur parseUnits USDC:", e); return ethers.BigNumber.from("0"); }
          }
          function scaleByExpo(valueString) {
            if(!valueString) return 0;
            const valFloat = parseFloat(valueString.replace(",", "."));
            if(isNaN(valFloat)) return 0;
            const factor = Math.pow(10, Math.abs(pythExpo));
            return Math.floor(valFloat * factor);
          }
          
          function incrementNum(inputId, delta) {
            const el = document.getElementById(inputId);
            let value = parseFloat(el.value.replace(",", ".")) || 0;
            const integerFields = ["limit_tpProfitUsd", "limit_tpProfitPct", "limit_slProfitUsd", "limit_slProfitPct"];
            const priceFields = ["pos_sl", "pos_tp", "limit_sl", "limit_tp"];
            const defaultFields = ["pos_size", "limit_size", "limit_targetPrice", "limit_leverage"];
            if(integerFields.includes(inputId)) {
              value += delta;
              el.value = value.toFixed(0);
            } else if(priceFields.includes(inputId)) {
              let step = 0.0001;
              value += delta*step;
              el.value = value.toFixed(4);
            } else if(defaultFields.includes(inputId)) {
              value += delta;
              el.value = value.toFixed(2);
            } else { value += delta; el.value = value; }
            if(["limit_size", "limit_targetPrice", "limit_leverage"].includes(inputId)) updateLimitOrderCalculations();
          }
          function setLeverage(inputId, val) {
            if(val < 1) val = 1;
            if(val > 100) val = 100;
            document.getElementById(inputId).value = val;
            updateLiquidationPrice();
            if(inputId === "limit_leverage") updateLimitOrderCalculations();
          }
          function incrementLeverage(inputId, delta) {
            const el = document.getElementById(inputId);
            let val = parseInt(el.value) || 1;
            val += delta;
            if(val < 1) val = 1;
            if(val > 100) val = 100;
            el.value = val;
            updateLiquidationPrice();
            if(inputId === "limit_leverage") updateLimitOrderCalculations();
          }
          
          async function applyPctOfBalancePos(percent) {
            try {
              const accounts = await signer.provider.listAccounts();
              if(!accounts[0]) return;
              const userAddress = accounts[0];
              const usdcContract = new ethers.Contract(usdcContractAddr, usdcAbi, signer);
              const rawBalance = await usdcContract.balanceOf(userAddress);
              const balanceFloat = parseFloat(ethers.utils.formatUnits(rawBalance,6));
              const newSize = balanceFloat * (percent/100);
              document.getElementById('pos_size').value = newSize.toFixed(2);
            } catch(e){ console.error("Erreur applyPctOfBalancePos:", e); }
          }
          async function applyPctOfBalance(percent) {
            try {
              const accounts = await signer.provider.listAccounts();
              if(!accounts[0]) return;
              const userAddress = accounts[0];
              const usdcContract = new ethers.Contract(usdcContractAddr, usdcAbi, signer);
              const rawBalance = await usdcContract.balanceOf(userAddress);
              const balanceFloat = parseFloat(ethers.utils.formatUnits(rawBalance,6));
              const newSize = balanceFloat * (percent/100);
              document.getElementById('limit_size').value = newSize.toFixed(2);
              updateLimitOrderCalculations();
            } catch(e){ console.error("Erreur applyPctOfBalance:", e); }
          }
          function updateLimitOrderCalculations() {
            if(document.getElementById('limit_sl').value !== "") limitOnSlPriceChange();
            if(document.getElementById('limit_tp').value !== "") limitOnTpPriceChange();
          }
          
          async function openPositionAction() {
            if(currentFeedCategory==="stock" && !checkTradingHours("stock")) {
              showNotification("Le marché est fermé pour les actions (9h30 - 16h30 NYT)", true);
              return;
            }
            if((currentFeedCategory==="forex" || currentFeedCategory==="metal") && !checkTradingHours(currentFeedCategory)) {
              showNotification("Le marché est fermé (uniquement ouvert du lundi au vendredi)", true);
              return;
            }
            try { await checkAndIncreaseAllowanceIfNeeded(); }
            catch(err){ setError("Erreur allowance : " + err.message); return; }
            if(!contract) { setError("Veuillez connecter MetaMask d'abord."); return; }
            if(latestPriceUpdate.length===0) { setError("Aucune donnée Pyth reçue. Attendez quelques secondes."); return; }
            const modeSlTp = isSlTpActive ? "on" : "off";
            const size = parseUSDC(document.getElementById('pos_size').value);
            const leverage = document.getElementById('pos_leverage').value;
            const slScaled = scaleByExpo(document.getElementById('pos_sl').value);
            const tpScaled = scaleByExpo(document.getElementById('pos_tp').value);
            try {
              let tx;
              if(modeSlTp==="off") {
                tx = await contract.openPosition(currentFeedId, latestPriceUpdate, size, isShortGlobal, leverage, {});
              } else {
                tx = await contract.openPositionWithSlTp(currentFeedId, latestPriceUpdate, size, isShortGlobal, leverage, slScaled, tpScaled, {});
              }
              showNotification("Transaction envoyée : <a href='https://testnet.snowscan.xyz/tx/" + tx.hash + "' target='_blank'>" + tx.hash + "</a>");
              await tx.wait();
              showNotification("Transaction confirmée : <a href='https://testnet.snowscan.xyz/tx/" + tx.hash + "' target='_blank'>" + tx.hash + "</a>");
              updateWalletBalance();
            } catch(err){ setError("Erreur openPositionAction : " + err.message); }
          }
          
          async function openLimitAction() {
            try { await checkAndIncreaseAllowanceIfNeeded(); }
            catch(err){ setError("Erreur allowance : " + err.message); return; }
            if(!contract) { setError("Veuillez connecter MetaMask d'abord."); return; }
            const modeSlTp = isSlTpActive ? "on" : "off";
            const size = parseUSDC(document.getElementById('limit_size').value);
            const leverage = document.getElementById('limit_leverage').value;
            const targetScaled = scaleByExpo(document.getElementById('limit_targetPrice').value);
            const slScaled = scaleByExpo(document.getElementById('limit_sl').value);
            const tpScaled = scaleByExpo(document.getElementById('limit_tp').value);
            try {
              let tx;
              if(modeSlTp==="off") {
                tx = await contract.openLimitOrder(currentFeedId, size, isShortGlobal, leverage, targetScaled);
              } else {
                tx = await contract.openLimitOrderWithSlTp(currentFeedId, size, isShortGlobal, leverage, targetScaled, slScaled, tpScaled);
              }
              showNotification("Transaction envoyée : <a href='https://testnet.snowscan.xyz/tx/" + tx.hash + "' target='_blank'>" + tx.hash + "</a>");
              await tx.wait();
              showNotification("Transaction confirmée : <a href='https://testnet.snowscan.xyz/tx/" + tx.hash + "' target='_blank'>" + tx.hash + "</a>");
              updateWalletBalance();
            } catch(err){ setError("Erreur openLimitAction : " + err.message); }
          }
          
          function limitCalcProfitFromPrice(exitPrice) {
            const tPrice = parseFloat(document.getElementById('limit_targetPrice').value)||0;
            const sizeVal = parseFloat(document.getElementById('limit_size').value)||0;
            const levVal = parseFloat(document.getElementById('limit_leverage').value)||1;
            const notional = sizeVal * levVal;
            if(tPrice<=0 || exitPrice<=0 || notional<=0) return 0;
            return !isShortGlobal ? (exitPrice-tPrice)/tPrice*notional : (tPrice-exitPrice)/tPrice*notional;
          }
          function limitCalcPriceFromProfit(profitUsd) {
            const tPrice = parseFloat(document.getElementById('limit_targetPrice').value)||0;
            const sizeVal = parseFloat(document.getElementById('limit_size').value)||0;
            const levVal = parseFloat(document.getElementById('limit_leverage').value)||1;
            const notional = sizeVal * levVal;
            if(tPrice<=0 || notional<=0) return 0;
            return !isShortGlobal ? tPrice + (profitUsd*tPrice)/notional : tPrice - (profitUsd*tPrice)/notional;
          }
          
          function limitOnSlPriceChange() {
            let price = parseFloat(document.getElementById('limit_sl').value)||0;
            let profit = limitCalcProfitFromPrice(price);
            profit = -Math.abs(profit);
            document.getElementById('limit_slProfitUsd').value = profit.toFixed(0);
            const sizeVal = parseFloat(document.getElementById('limit_size').value)||1;
            const pct = (profit/sizeVal)*100;
            document.getElementById('limit_slProfitPct').value = pct.toFixed(0);
          }
          function limitOnSlProfitUsdChange() {
            let profit = parseFloat(document.getElementById('limit_slProfitUsd').value)||0;
            profit = -Math.abs(profit);
            document.getElementById('limit_slProfitUsd').value = profit.toFixed(0);
            const price = limitCalcPriceFromProfit(profit);
            document.getElementById('limit_sl').value = price.toFixed(4);
            const sizeVal = parseFloat(document.getElementById('limit_size').value)||1;
            const pct = (profit/sizeVal)*100;
            document.getElementById('limit_slProfitPct').value = pct.toFixed(0);
          }
          function limitOnSlProfitPctChange() {
            let pct = parseFloat(document.getElementById('limit_slProfitPct').value)||0;
            pct = -Math.abs(pct);
            document.getElementById('limit_slProfitPct').value = pct.toFixed(0);
            const sizeVal = parseFloat(document.getElementById('limit_size').value)||1;
            const profit = (pct/100)*sizeVal;
            document.getElementById('limit_slProfitUsd').value = profit.toFixed(0);
            const price = limitCalcPriceFromProfit(profit);
            document.getElementById('limit_sl').value = price.toFixed(4);
          }
          function limitOnTpPriceChange() {
            let price = parseFloat(document.getElementById('limit_tp').value)||0;
            let profit = limitCalcProfitFromPrice(price);
            document.getElementById('limit_tpProfitUsd').value = profit.toFixed(0);
            const sizeVal = parseFloat(document.getElementById('limit_size').value)||1;
            const pct = (profit/sizeVal)*100;
            document.getElementById('limit_tpProfitPct').value = pct.toFixed(0);
          }
          function limitOnTpProfitUsdChange() {
            let profit = parseFloat(document.getElementById('limit_tpProfitUsd').value)||0;
            document.getElementById('limit_tpProfitUsd').value = profit.toFixed(0);
            const price = limitCalcPriceFromProfit(profit);
            document.getElementById('limit_tp').value = price.toFixed(4);
            const sizeVal = parseFloat(document.getElementById('limit_size').value)||1;
            const pct = (profit/sizeVal)*100;
            document.getElementById('limit_tpProfitPct').value = pct.toFixed(0);
          }
          function limitOnTpProfitPctChange() {
            let pct = parseFloat(document.getElementById('limit_tpProfitPct').value)||0;
            document.getElementById('limit_tpProfitPct').value = pct.toFixed(0);
            const sizeVal = parseFloat(document.getElementById('limit_size').value)||1;
            const profit = (pct/100)*sizeVal;
            document.getElementById('limit_tpProfitUsd').value = profit.toFixed(0);
            const price = limitCalcPriceFromProfit(profit);
            document.getElementById('limit_tp').value = price.toFixed(4);
          }
          
          function toggleSLTP() {
            isSlTpActive = !isSlTpActive;
            document.getElementById('globalSlTpStatus').textContent = isSlTpActive ? "SL/TP activés" : "SL/TP désactivés";
            document.getElementById('toggleSLTP').textContent = isSlTpActive ? "Désactiver SL/TP" : "Activer SL/TP";
          }
          
          function checkTradingHours(category) {
            const nowNY = new Date(new Date().toLocaleString("en-US",{timeZone:"America/New_York"}));
            const day = nowNY.getDay();
            if(day===0 || day===6) return false;
            if(category==="stock") {
              const nowMinutes = nowNY.getHours()*60+nowNY.getMinutes();
              return (nowMinutes >= (9*60+30) && nowMinutes <= (16*60+30));
            }
            if(category==="forex" || category==="metal") return true;
            return false;
          }
          
          /********* FONCTION DE SÉLECTION D'ACTIF (REMPLACANT changeFeed) *********/
          function selectAsset(assetKey) {
            currentAsset = assets[assetKey];
            currentFeedId = currentAsset.feedId;
            currentFeedCategory = currentAsset.category;
            initEventSource();
            initPriceStream(currentAsset);
            updateInfo(currentAsset);
            updateHistorical(currentAsset);
            initChart();
            showNotification("Feed changé : " + assetKey);
          }
          
          // Initialisation par défaut lors du chargement de la page (choix de l'actif AAPL)
          window.addEventListener('load', ()=> {
            selectAsset('AAPL');
          });
          
          // Gestion des boutons de résolution et type de graphique
          document.querySelectorAll('.w-button[data-resolution]').forEach(button=>{
            button.addEventListener('click', async e=>{
              e.preventDefault();
              currentResolution = e.target.dataset.resolution;
              document.querySelectorAll('.w-button').forEach(b=>b.classList.remove('active'));
              e.target.classList.add('active');
              await initChart();
            });
          });
          const candleSVG = `
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" app="ikonik" class="ikonik-mc3dr">
            <path d="M7 16L12.25 10.75L15.75 14.25L21 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" app="ikonik" class="path-cy7k1"></path>
            <path d="M21 21H3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" app="ikonik" class="path-grztl"></path>
            <path d="M3 3V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" app="ikonik" class="path-t2hxn"></path>
          </svg>
          `;
          
          const lineSVG = `
          <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 15 15" fill="none" app="ikonik" class="ikonik-9u3h3i-2">
            <path d="M0.5 0V14.5H15M8.5 0V3.5M3.5 9.5V12M3.5 4V5.5M13.5 4V6.5M13.5 10.5V13M2.5 5.5H4.5V9.5H2.5V5.5ZM7.5 3.5H9.5V7.5H7.5V3.5ZM12.5 6.5H14.5V10.5H12.5V6.5Z" stroke="currentColor" app="ikonik" class="path-yz0y"></path>
          </svg>
          `;
          
          document.getElementById('chartTypeToggle').addEventListener('click', () => {
            showCandles = !showCandles;
            candleSeries.applyOptions({ visible: showCandles });
            lineSeries.applyOptions({ visible: !showCandles });
          
            const toggleBtn = document.getElementById('chartTypeToggle');
            toggleBtn.innerHTML = showCandles ? lineSVG : candleSVG;
          });
          
          // Bouton de bascule du thème (sombre/clair)
          document.getElementById('charttheme').addEventListener('click', () => {
            isDarkTheme = !isDarkTheme;
            initChart();
            showNotification("Thème changé en " + (isDarkTheme ? "Sombre" : "Clair"));
          });
          
          window.addEventListener('resize', ()=>{
            const container = document.getElementById('chartContainer');
            if(chart) chart.resize(container.clientWidth, container.clientHeight);
          });
          
          /********* EXPOSITION DES FONCTIONS POUR LES EVENTS HTML *********/
          window.connectWallet = connectWallet;
          window.selectAsset = selectAsset;
          window.openPositionAction = openPositionAction;
          window.openLimitAction = openLimitAction;
          window.toggleSLTP = toggleSLTP;
          window.setIsShortValue = setIsShortValue;
          window.incrementNum = incrementNum;
          window.setLeverage = setLeverage;
          window.incrementLeverage = incrementLeverage;
          window.applyPctOfBalancePos = applyPctOfBalancePos;
          window.applyPctOfBalance = applyPctOfBalance;
          window.limitOnSlPriceChange = limitOnSlPriceChange;
          window.limitOnSlProfitUsdChange = limitOnSlProfitUsdChange;
          window.limitOnSlProfitPctChange = limitOnSlProfitPctChange;
          window.limitOnTpPriceChange = limitOnTpPriceChange;
          window.limitOnTpProfitUsdChange = limitOnTpProfitUsdChange;
          window.limitOnTpProfitPctChange = limitOnTpProfitPctChange;
          
        })();
      </script>
      
      
      
      
     <script>
      const assetIds = [
      "0x49f6b65cb1de6b10eaf75e7c03ca029c306d0357e91b5311b175084a5ad55688",
  "0xb5d0e0fa58a1f8b81498ae670ce93c872d14434b72c364885d4fa1b257cbb07a",
  "0xfee33f2a978bf32dd6b662b65ba8083c6773b494f8401194ec1870c640860245",
  "0xe65ff435be42630439c96396653a342829e877e2aafaeaf1a10d0ee5fd2cf3f2",
  "0x6f9cd89ef1b7fd39f667101a91ad578b6c6ace4579d5f7f285a4b06aa4504be6",
  "0xc1751e085ee292b8b3b9dd122a135614485a201c35dfc653553f0e28c1baf3ff",
  "0x9aa471dccea36b90703325225ac76189baf7e0cc286b8843de1de4f31f9caa7d",
  "0xd3178156b7c0f6ce10d6da7d347952a672467b51708baaf1a57ffe1fb005824a",
  "0xd0ca23c1cc005e004ccf1db5bf76aeb6a49218f43dac3d4b275e92de12ded4d1",
  "0x67649450b4ca4bfff97cbaf96d2fd9e40f6db148cb65999140154415e4378e14",
  "0x78a3e3b8e676a8f73c439f5d749737034b139bbbe899ba5775216fba596607fe",
  "0xb1073854ed24cbc755dc527418f52b7d271f6cc967bbf8d8129112b18860a593",
  "0x16dad506d7db8da01c87581c87ca897a012a153557d4d578c3b9c9e1bc0632f1",
  "0x67a6f93030420c1c9e3fe37c1ab6b77966af82f995944a9fefce357a22854a80",
  "0xa995d00bb36a63cef7fd2c287dc105fc8f3d93779f062f09551b0af3e81ec30b",
  "0x84c2dde9633d93d1bcad84e7dc41c9d56578b7ec52fabedc1f335d673df0a7c1",
  "0x92eea8ba1b00078cdc2ef6f64f091f262e8c7d0576ee4677572f314ebfafa4c7",
  "0x3112b03a41c910ed446852aacf67118cb1bec67b2cd0b9a214c58cc0eaa2ecca",
  "0x0b1e3297e69f162877b577b0d6a47a0d63b2392bc8499e6540da4187a63e28f8",
  "0xef2c98c804ba503c6a707e38be4dfbb16683775f195b091252bf24693042fd52",
  "0xf2fb02c32b055c805e7238d628e5e9dadef274376114eb1f012337cabe93871e",
  "0x765d2ba906dbc32ca17cc11f5310a89e9ee1f6420508c63861f2f8ba4ee34bb2"
      ];
  
      function isNYinDST(date) {
          const year = date.getFullYear();
          let startDST = new Date(Date.UTC(year, 2, 8, 7, 0, 0));
          startDST.setUTCDate(startDST.getUTCDate() - startDST.getUTCDay());
          let endDST = new Date(Date.UTC(year, 10, 1, 6, 0, 0));
          endDST.setUTCDate(endDST.getUTCDate() - endDST.getUTCDay());
          return date >= startDST && date < endDST;
      }
  
      function get10amUnixTimeNewYork() {
          const now = new Date();
          let targetDate = new Date(now);
          const dayOfWeek = now.getUTCDay();
          
          if (dayOfWeek === 0 || dayOfWeek === 6 || dayOfWeek === 1) {
              let daysToSubtract = dayOfWeek === 1 ? 3 : dayOfWeek === 6 ? 1 : 2;
              targetDate.setUTCDate(now.getUTCDate() - daysToSubtract);
          } else {
              targetDate.setUTCDate(now.getUTCDate() - 1);
          }
          
          const inDST = isNYinDST(targetDate);
          targetDate.setUTCHours(inDST ? 14 : 15, 0, 0, 0);
          return Math.floor(targetDate.getTime() / 1000);
      }
  
      async function fetchHistoricalPrices() {
          const unixTime = get10amUnixTimeNewYork();
          const url = `https://hermes.pyth.network/v2/updates/price/${unixTime}?${assetIds.map(id => `ids%5B%5D=${id}`).join("&")}`;
          try {
              const response = await fetch(url);
              const data = await response.json();
              return data.parsed.map(asset => ({
                  id: asset.id,
                  price: parseFloat(asset.price.price) * Math.pow(10, asset.price.expo)
              }));
          } catch (error) {
              console.error("Erreur historique:", error);
              return [];
          }
      }
  
      async function fetchLatestPrices() {
          const url = `https://hermes.pyth.network/v2/updates/price/latest?${assetIds.map(id => `ids%5B%5D=${id}`).join("&")}`;
          try {
              const response = await fetch(url);
              const data = await response.json();
              return data.parsed.map(asset => ({
                  id: asset.id,
                  price: parseFloat(asset.price.price) * Math.pow(10, asset.price.expo)
              }));
          } catch (error) {
              console.error("Erreur données actuelles:", error);
              return [];
          }
      }
  
      async function updatePercentages() {
          const latestPrices = await fetchLatestPrices();
          const historicalPrices = await fetchHistoricalPrices();
  
          latestPrices.forEach((latest, index) => {
              const historical = historicalPrices.find(h => h.id === latest.id);
              const span = document.getElementById(`percentage-${index}`);
              
              if (historical && span) {
                  const differencePercent = ((latest.price - historical.price) / historical.price * 100).toFixed(2);
                  span.textContent = `${differencePercent}%`;
                  span.className = `asset-percentage ${differencePercent > 0 ? 'price-up' : differencePercent < 0 ? 'price-down' : 'price-neutral'}`;
              }
          });
      }
  
      // Mise à jour toutes les secondes
      setInterval(updatePercentages, 10000);
      window.onload = updatePercentages;
  </script>
   <script>
      /* Tableau regroupant TOUS les actifs avec leur clé hex (pour l'API statique),
         identifiant streaming et une propriété pour le prix précédent */
      const assets = [
        // Actions (Equity)
        { hex: "0x49f6b65cb1de6b10eaf75e7c03ca029c306d0357e91b5311b175084a5ad55688", streamingId: "Equity.US.AAPL/USD", prevPrice: null },
        { hex: "0xb5d0e0fa58a1f8b81498ae670ce93c872d14434b72c364885d4fa1b257cbb07a", streamingId: "Equity.US.AMZN/USD", prevPrice: null },
        { hex: "0xfee33f2a978bf32dd6b662b65ba8083c6773b494f8401194ec1870c640860245", streamingId: "Equity.US.COIN/USD", prevPrice: null },
        { hex: "0xe65ff435be42630439c96396653a342829e877e2aafaeaf1a10d0ee5fd2cf3f2", streamingId: "Equity.US.GOOG/USD", prevPrice: null },
        { hex: "0x6f9cd89ef1b7fd39f667101a91ad578b6c6ace4579d5f7f285a4b06aa4504be6", streamingId: "Equity.US.GME/USD", prevPrice: null },
        { hex: "0xc1751e085ee292b8b3b9dd122a135614485a201c35dfc653553f0e28c1baf3ff", streamingId: "Equity.US.INTC/USD", prevPrice: null },
        { hex: "0x9aa471dccea36b90703325225ac76189baf7e0cc286b8843de1de4f31f9caa7d", streamingId: "Equity.US.KO/USD", prevPrice: null },
        { hex: "0xd3178156b7c0f6ce10d6da7d347952a672467b51708baaf1a57ffe1fb005824a", streamingId: "Equity.US.MCD/USD", prevPrice: null },
        { hex: "0xd0ca23c1cc005e004ccf1db5bf76aeb6a49218f43dac3d4b275e92de12ded4d1", streamingId: "Equity.US.MSFT/USD", prevPrice: null },
        { hex: "0x67649450b4ca4bfff97cbaf96d2fd9e40f6db148cb65999140154415e4378e14", streamingId: "Equity.US.NKE/USD", prevPrice: null },
        { hex: "0x78a3e3b8e676a8f73c439f5d749737034b139bbbe899ba5775216fba596607fe", streamingId: "Equity.US.NVDA/USD", prevPrice: null },
        { hex: "0xb1073854ed24cbc755dc527418f52b7d271f6cc967bbf8d8129112b18860a593", streamingId: "Equity.US.META/USD", prevPrice: null },
        { hex: "0x16dad506d7db8da01c87581c87ca897a012a153557d4d578c3b9c9e1bc0632f1", streamingId: "Equity.US.TSLA/USD", prevPrice: null },
        
        // Forex
        { hex: "0x67a6f93030420c1c9e3fe37c1ab6b77966af82f995944a9fefce357a22854a80", streamingId: "FX.AUD/USD", prevPrice: null },
        { hex: "0xa995d00bb36a63cef7fd2c287dc105fc8f3d93779f062f09551b0af3e81ec30b", streamingId: "FX.EUR/USD", prevPrice: null },
        { hex: "0x84c2dde9633d93d1bcad84e7dc41c9d56578b7ec52fabedc1f335d673df0a7c1", streamingId: "FX.GBP/USD", prevPrice: null },
        { hex: "0x92eea8ba1b00078cdc2ef6f64f091f262e8c7d0576ee4677572f314ebfafa4c7", streamingId: "FX.NZD/USD", prevPrice: null },
        { hex: "0x3112b03a41c910ed446852aacf67118cb1bec67b2cd0b9a214c58cc0eaa2ecca", streamingId: "FX.USD/CAD", prevPrice: null },
        { hex: "0x0b1e3297e69f162877b577b0d6a47a0d63b2392bc8499e6540da4187a63e28f8", streamingId: "FX.USD/CHF", prevPrice: null },
        { hex: "0xef2c98c804ba503c6a707e38be4dfbb16683775f195b091252bf24693042fd52", streamingId: "FX.USD/JPY", prevPrice: null },
        
        // Métaux
        { hex: "0xf2fb02c32b055c805e7238d628e5e9dadef274376114eb1f012337cabe93871e", streamingId: "Metal.XAU/USD", prevPrice: null },
        { hex: "0x765d2ba906dbc32ca17cc11f5310a89e9ee1f6420508c63861f2f8ba4ee34bb2", streamingId: "Metal.XAG/USD", prevPrice: null }
      ];
      
      // Récupère l'heure actuelle à New York
      function getNewYorkTime() {
        const date = new Date();
        const formatter = new Intl.DateTimeFormat('en-US', {
          timeZone: 'America/New_York',
          hour: 'numeric',
          minute: 'numeric',
          weekday: 'short',
          hour12: false
        });
        const parts = formatter.formatToParts(date);
        let hour, minute, weekday;
        parts.forEach(part => {
          if (part.type === 'hour') hour = parseInt(part.value);
          else if (part.type === 'minute') minute = parseInt(part.value);
          else if (part.type === 'weekday') weekday = part.value;
        });
        return { hour, minute, weekday };
      }
      
      // Retourne true si aujourd'hui est un jour ouvré (Mon-Fri)
      function isWeekday() {
        const { weekday } = getNewYorkTime();
        return ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'].includes(weekday);
      }
      
      /* Pour chaque actif, détermine si son marché est ouvert :
         - Pour les Actions : ouvert si jour ouvré ET entre 9h30 et 16h30.
         - Pour le Forex et les Métaux : ouvert si jour ouvré (24h/24).
      */
      function isAssetMarketOpen(asset) {
        const { hour, minute, weekday } = getNewYorkTime();
        const isDay = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'].includes(weekday);
        if (asset.streamingId.startsWith("Equity")) {
          const totalMinutes = hour * 60 + minute;
          const openEquity = (totalMinutes >= (9 * 60 + 30) && totalMinutes <= (16 * 60 + 30));
          return isDay && openEquity;
        } else if (asset.streamingId.startsWith("FX") || asset.streamingId.startsWith("Metal")) {
          return isDay;
        }
        return false;
      }
      
      // ===================== STATIC UPDATE =====================
      // Récupère les prix via l'API statique pour les actifs dont le marché est fermé
      async function fetchStaticPrices() {
        const queryParams = assets.map(asset => "ids%5B%5D=" + asset.hex).join('&');
        const url = `https://hermes.pyth.network/v2/updates/price/latest?${queryParams}`;
        try {
          const response = await fetch(url);
          if (!response.ok) throw new Error(`Erreur HTTP : ${response.status}`);
          const data = await response.json();
          if (data && data.parsed) {
            data.parsed.forEach(item => {
              assets.forEach(asset => {
                if (item.id === asset.hex.slice(2)) {
                  // On met à jour uniquement si le marché de l'actif est fermé
                  if (!isAssetMarketOpen(asset)) {
                    const computedPrice = Number(item.price.price) * Math.pow(10, item.price.expo);
                    // Pour le Forex, 4 décimales ; sinon 2
                    const decimals = asset.streamingId.startsWith("FX") ? 4 : 2;
                    const formattedPrice = computedPrice.toFixed(decimals);
                    document.getElementById(`price-${asset.hex.slice(2)}`).textContent = formattedPrice;
                  }
                }
              });
            });
          }
        } catch (error) {
          console.error('Erreur lors de la récupération statique :', error);
        }
      }
      
      // ===================== STREAMING UPDATE =====================
      let streamingAbortController = null;
      
      // Lance le streaming et met à jour en temps réel pour les actifs dont le marché est ouvert
      function startStreaming() {
        if (streamingAbortController) return; // Évite plusieurs lancements
        streamingAbortController = new AbortController();
        const url = 'https://benchmarks.pyth.network/v1/shims/tradingview/streaming';
        fetch(url, { signal: streamingAbortController.signal })
          .then(response => {
            if (!response.ok) throw new Error(`Erreur HTTP : ${response.status}`);
            const reader = response.body.getReader();
            const decoder = new TextDecoder("utf-8");
            let partialChunk = '';
            (async function readStream() {
              while (true) {
                const { done, value } = await reader.read();
                if (done) break;
                const chunk = decoder.decode(value, { stream: true });
                partialChunk += chunk;
                let lines = partialChunk.split('\n');
                partialChunk = lines.pop();
                lines.forEach(line => {
                  if (line.trim() === '') return;
                  try {
                    const data = JSON.parse(line);
                    assets.forEach(asset => {
                      if (data.id === asset.streamingId) {
                        // On met à jour via streaming uniquement si le marché de l'actif est ouvert
                        if (isAssetMarketOpen(asset)) {
                          const newPrice = parseFloat(data.p);
                          // Pour le Forex, 4 décimales ; sinon 2
                          const decimals = asset.streamingId.startsWith("FX") ? 4 : 2;
                          const formattedPrice = newPrice.toFixed(decimals);
                          let html = `<span>${formattedPrice}</span>`;
                          if (asset.prevPrice !== null) {
                            if (newPrice > asset.prevPrice) {
                              html = `<span">${formattedPrice} </span>`;
                            } else if (newPrice < asset.prevPrice) {
                              html = `<span">${formattedPrice} </span>`;
                            }
                          }
                          document.getElementById(`price-${asset.hex.slice(2)}`).innerHTML = html;
                          asset.prevPrice = newPrice;
                        }
                      }
                    });
                  } catch (e) {
                    console.error('Erreur lors du parsing JSON:', e);
                  }
                });
              }
            })();
          })
          .catch(error => {
            if (error.name !== 'AbortError') {
              console.error('Erreur lors du streaming :', error);
            }
          });
      }
      
      function stopStreaming() {
        if (streamingAbortController) {
          streamingAbortController.abort();
          streamingAbortController = null;
        }
      }
      
      // ===================== GESTION DES MISES À JOUR =====================
      // Lancer la mise à jour streaming si c'est un jour ouvré, sinon l'arrêter.
      function updatePrices() {
        if (isWeekday()) {
          // En semaine, le Forex et les Métaux sont ouverts (streaming) même si les actions sont fermées
          startStreaming();
        } else {
          stopStreaming();
        }
        // Le static update se chargera de mettre à jour les actifs dont le marché est fermé
        fetchStaticPrices();
      }
      
      // Rafraîchissement statique toutes les minutes
      let staticInterval = setInterval(fetchStaticPrices, 60000);
      // Vérification périodique (toutes les minutes) pour lancer/arrêter le streaming selon le jour/horaire
      setInterval(updatePrices, 60000);
      
      // Mise à jour initiale au chargement
      updatePrices();
    </script>
<script>
    /************* CONTRACT CONFIGURATION *************/
    let provider, signer, contract;
    const contractAddress = "0xac51dd5ad45dc78661646f1e62aa0e8c60af086b";
    const contractABI = [
      {
        "inputs": [{"internalType": "address","name": "trader","type": "address"}],
        "name": "getTraderAllIds",
        "outputs": [
          {"internalType": "uint256[]","name": "openPositionIds","type": "uint256[]"},
          {"internalType": "uint256[]","name": "closedPositionIds","type": "uint256[]"},
          {"internalType": "uint256[]","name": "limitOrderIds","type": "uint256[]"}
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [{"internalType": "uint256","name": "","type": "uint256"}],
        "name": "positions",
        "outputs": [
          {"internalType": "uint256","name": "id","type": "uint256"},
          {"internalType": "address","name": "trader","type": "address"},
          {"internalType": "bool","name": "isShort","type": "bool"},
          {"internalType": "uint256","name": "size","type": "uint256"},
          {"internalType": "int256","name": "openPrice","type": "int256"},
          {"internalType": "uint256","name": "timestamp","type": "uint256"},
          {"internalType": "uint256","name": "openBlock","type": "uint256"},
          {"internalType": "bytes32","name": "assetId","type": "bytes32"},
          {"internalType": "uint256","name": "leverage","type": "uint256"}
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [{"internalType": "uint256","name": "","type": "uint256"}],
        "name": "closedPositions",
        "outputs": [
          {"internalType": "uint256","name": "id","type": "uint256"},
          {"internalType": "address","name": "trader","type": "address"},
          {"internalType": "bool","name": "isShort","type": "bool"},
          {"internalType": "uint256","name": "size","type": "uint256"},
          {"internalType": "int256","name": "openPrice","type": "int256"},
          {"internalType": "int256","name": "closePrice","type": "int256"},
          {"internalType": "uint256","name": "openTimestamp","type": "uint256"},
          {"internalType": "uint256","name": "closeTimestamp","type": "uint256"},
          {"internalType": "uint256","name": "openBlock","type": "uint256"},
          {"internalType": "uint256","name": "closeBlock","type": "uint256"},
          {"internalType": "bytes32","name": "assetId","type": "bytes32"},
          {"internalType": "uint256","name": "finalAmount","type": "uint256"},
          {"internalType": "int256","name": "profit","type": "int256"},
          {"internalType": "uint256","name": "leverage","type": "uint256"},
          {"internalType": "int256","name": "liquidationPrice","type": "int256"},
          {"internalType": "int256","name": "stopLoss","type": "int256"},
          {"internalType": "int256","name": "takeProfit","type": "int256"}
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [{"internalType": "uint256","name": "","type": "uint256"}],
        "name": "limitOrders",
        "outputs": [
          {"internalType": "uint256","name": "id","type": "uint256"},
          {"internalType": "address","name": "trader","type": "address"},
          {"internalType": "bool","name": "isShort","type": "bool"},
          {"internalType": "uint256","name": "size","type": "uint256"},
          {"internalType": "uint256","name": "leverage","type": "uint256"},
          {"internalType": "bytes32","name": "assetId","type": "bytes32"},
          {"internalType": "int256","name": "targetPrice","type": "int256"},
          {"internalType": "int256","name": "stopLoss","type": "int256"},
          {"internalType": "int256","name": "takeProfit","type": "int256"},
          {"internalType": "uint256","name": "timestamp","type": "uint256"}
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [{"internalType": "uint256","name": "","type": "uint256"}],
        "name": "stopLosses",
        "outputs": [{"internalType": "int256","name": "","type": "int256"}],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [{"internalType": "uint256","name": "","type": "uint256"}],
        "name": "takeProfits",
        "outputs": [{"internalType": "int256","name": "","type": "int256"}],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [{"internalType": "uint256","name": "","type": "uint256"}],
        "name": "liquidationPrices",
        "outputs": [{"internalType": "int256","name": "","type": "int256"}],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          {"internalType": "uint256","name": "positionId","type": "uint256"},
          {"internalType": "int256","name": "newStopLoss","type": "int256"}
        ],
        "name": "updateStopLoss",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {"internalType": "uint256","name": "positionId","type": "uint256"},
          {"internalType": "int256","name": "newTakeProfit","type": "int256"}
        ],
        "name": "updateTakeProfit",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {"internalType": "uint256","name": "positionId","type": "uint256"},
          {"internalType": "bytes[]","name": "priceUpdate","type": "bytes[]"}
        ],
        "name": "closePosition",
        "outputs": [
          {"internalType": "uint256","name": "finalAmount","type": "uint256"},
          {"internalType": "int256","name": "profit","type": "int256"}
        ],
        "stateMutability": "payable",
        "type": "function"
      },
      {
        "inputs": [
          {"internalType": "uint256","name": "orderId","type": "uint256"}
        ],
        "name": "cancelLimitOrder",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "anonymous": false,
        "inputs": [
          {"indexed": true,"internalType": "uint256","name": "positionId","type": "uint256"},
          {"indexed": true,"internalType": "address","name": "trader","type": "address"},
          {"indexed": false,"internalType": "int256","name": "profit","type": "int256"},
          {"indexed": false,"internalType": "uint256","name": "closingTimestamp","type": "uint256"}
        ],
        "name": "PositionClosed",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {"indexed": true,"internalType": "uint256","name": "positionId","type": "uint256"},
          {"indexed": true,"internalType": "address","name": "trader","type": "address"},
          {"indexed": false,"internalType": "int256","name": "openPrice","type": "int256"},
          {"indexed": false,"internalType": "int256","name": "liquidationPrice","type": "int256"},
          {"indexed": false,"internalType": "uint256","name": "size","type": "uint256"},
          {"indexed": false,"internalType": "bool","name": "isShort","type": "bool"},
          {"indexed": false,"internalType": "uint256","name": "leverage","type": "uint256"},
          {"indexed": false,"internalType": "int256","name": "stopLoss","type": "int256"},
          {"indexed": false,"internalType": "int256","name": "takeProfit","type": "int256"}
        ],
        "name": "PositionOpened",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {"indexed": true,"internalType": "uint256","name": "orderId","type": "uint256"},
          {"indexed": true,"internalType": "address","name": "trader","type": "address"}
        ],
        "name": "LimitOrderCanceled",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {"indexed": true,"internalType": "uint256","name": "orderId","type": "uint256"},
          {"indexed": true,"internalType": "uint256","name": "positionId","type": "uint256"},
          {"indexed": true,"internalType": "address","name": "trader","type": "address"},
          {"indexed": false,"internalType": "int256","name": "executionPrice","type": "int256"}
        ],
        "name": "LimitOrderExecuted",
        "type": "event"
      }
    ];
  
    /************* ASSET MAPPING AND EXPONENTS *************/
    const assetMapping = {
      "0x49f6b65cb1de6b10eaf75e7c03ca029c306d0357e91b5311b175084a5ad55688": { symbol: "AAPL", expo: -5 },
      "0xb5d0e0fa58a1f8b81498ae670ce93c872d14434b72c364885d4fa1b257cbb07a": { symbol: "AMZN", expo: -5 },
      "0xfee33f2a978bf32dd6b662b65ba8083c6773b494f8401194ec1870c640860245": { symbol: "COIN", expo: -5 },
      "0xe65ff435be42630439c96396653a342829e877e2aafaeaf1a10d0ee5fd2cf3f2": { symbol: "GOOG", expo: -5 },
      "0x6f9cd89ef1b7fd39f667101a91ad578b6c6ace4579d5f7f285a4b06aa4504be6": { symbol: "GME", expo: -5 },
      "0xc1751e085ee292b8b3b9dd122a135614485a201c35dfc653553f0e28c1baf3ff": { symbol: "INTC", expo: -5 },
      "0x9aa471dccea36b90703325225ac76189baf7e0cc286b8843de1de4f31f9caa7d": { symbol: "KO", expo: -5 },
      "0xd3178156b7c0f6ce10d6da7d347952a672467b51708baaf1a57ffe1fb005824a": { symbol: "MCD", expo: -5 },
      "0xd0ca23c1cc005e004ccf1db5bf76aeb6a49218f43dac3d4b275e92de12ded4d1": { symbol: "MSFT", expo: -5 },
      "0x67649450b4ca4bfff97cbaf96d2fd9e40f6db148cb65999140154415e4378e14": { symbol: "NIKE", expo: -5 },
      "0x78a3e3b8e676a8f73c439f5d749737034b139bbbe899ba5775216fba596607fe": { symbol: "NVDA", expo: -5 },
      "0xb1073854ed24cbc755dc527418f52b7d271f6cc967bbf8d8129112b18860a593": { symbol: "META", expo: -5 },
      "0x16dad506d7db8da01c87581c87ca897a012a153557d4d578c3b9c9e1bc0632f1": { symbol: "TSLA", expo: -5 },
      "0x67a6f93030420c1c9e3fe37c1ab6b77966af82f995944a9fefce357a22854a80": { symbol: "AUDUSD", expo: -5 },
      "0xa995d00bb36a63cef7fd2c287dc105fc8f3d93779f062f09551b0af3e81ec30b": { symbol: "EUR", expo: -5 },
      "0x84c2dde9633d93d1bcad84e7dc41c9d56578b7ec52fabedc1f335d673df0a7c1": { symbol: "GBP", expo: -5 },
      "0x92eea8ba1b00078cdc2ef6f64f091f262e8c7d0576ee4677572f314ebfafa4c7": { symbol: "NZD", expo: -5 },
      "0x3112b03a41c910ed446852aacf67118cb1bec67b2cd0b9a214c58cc0eaa2ecca": { symbol: "CAD", expo: -5 },
      "0x0b1e3297e69f162877b577b0d6a47a0d63b2392bc8499e6540da4187a63e28f8": { symbol: "CHF", expo: -5 },
      "0xef2c98c804ba503c6a707e38be4dfbb16683775f195b091252bf24693042fd52": { symbol: "JPY", expo: -3 },
      "0xf2fb02c32b055c805e7238d628e5e9dadef274376114eb1f012337cabe93871e": { symbol: "XAGUSD", expo: -5 },
      "0x765d2ba906dbc32ca17cc11f5310a89e9ee1f6420508c63861f2f8ba4ee34bb2": { symbol: "XAU", expo: -3 },
      "0x0bbf28e9a841a1cc788f6a361b17ca072d0ea3098a1e5df1c3922d06719579ff": { symbol: "PYTH", expo: -8 },
      "0xff61491a931112ddf1bd8147cd1b641375f79f5825126d665480874634fd0ace": { symbol: "ETH", expo: -8 }
    };
  
    /************* PRICE FORMATTING *************/
    function isForexAsset(symbol) {
      const forexSymbols = ["EURUSD", "GBPUSD", "AUDUSD", "NZDUSD", "USDCAD", "USDCHF", "PYTH"];
      return forexSymbols.includes(symbol);
    }
    function formatPrice(value, assetSymbol) {
      return isForexAsset(assetSymbol) ? value.toFixed(4) : value.toFixed(2);
    }
    function profitFormat(value) {
      return value.toFixed(2);
    }
    function usdcFormat(value) {
      return value.toFixed(2);
    }
    function convertField(fieldLabel, value) {
      const lowerLabel = fieldLabel.toLowerCase();
      if (lowerLabel.includes("timestamp")) {
        return formatTimestamp(value);
      }
      if (lowerLabel === "size" || lowerLabel === "finalamount") {
        return usdcFormat(Number(ethers.utils.formatUnits(value, 6)));
      }
      if (lowerLabel === "profit") {
        return Number(ethers.utils.formatUnits(value, 6)).toString();
      }
      if (lowerLabel === "isshort") {
        return value ? "short" : "long";
      }
      if (lowerLabel === "assetid") {
        const rawAssetId = value.toString();
        return assetMapping[rawAssetId] ? assetMapping[rawAssetId].symbol : rawAssetId;
      }
      return value.toString();
    }
    function formatTimestamp(ts) {
      const date = new Date(Number(ts) * 1000);
      const dd = String(date.getDate()).padStart(2, '0');
      const mm = String(date.getMonth() + 1).padStart(2, '0');
      const yyyy = date.getFullYear();
      const hh = String(date.getHours()).padStart(2, '0');
      const min = String(date.getMinutes()).padStart(2, '0');
      const ss = String(date.getSeconds()).padStart(2, '0');
      return `${dd}-${mm}-${yyyy} at ${hh}:${min}:${ss}`;
    }
    function applyExpo(value, expo) {
      return Number(value) * Math.pow(10, expo);
    }
    function applyExpoWithMapping(value, assetId) {
      const expo = assetMapping[assetId] ? assetMapping[assetId].expo : 0;
      return Number(value) * Math.pow(10, expo);
    }
  
    /************* CACHE VARIABLES *************/
    let cachedOpenPositions = [];
    let cachedStopLosses = [];
    let cachedTakeProfits = [];
    let cachedLiquidationPrices = [];
    let cachedClosedPositions = [];
    let cachedLimitOrders = [];
    let stopLossInputs = {};
    let takeProfitInputs = {};
    let livePrices = {}; // Used for streaming
  
    /************* TEXT SELECTION DETECTION *************/
    function isUserSelectingText() {
      if (window.getSelection) {
        const selection = window.getSelection();
        return selection && selection.type === 'Range' && !selection.isCollapsed;
      }
      return false;
    }
  
    /************* NOTIFICATION FUNCTION *************/
    // Displays a custom notification message in the div with ID "notification"
    function showNotification(message) {
      const notificationDiv = document.getElementById('notification');
      notificationDiv.innerText = message;
      notificationDiv.style.display = 'block';
      // Hide notification after 3 seconds
      setTimeout(() => {
        notificationDiv.style.display = 'none';
      }, 3000);
    }
  
    /************* RENDERING TABLES *************/
    function renderTable(category, data, fields) {
      let html = `<h3>${category} (${data.length})</h3>`;
      data.forEach((item, index) => {
        html += `<h4>${category} ${index}</h4>`;
        html += '<table>';
        fields.forEach((field, i) => {
          const rawVal = item[i];
          const fieldName = field.label;
          let displayValue = convertField(fieldName, rawVal);
          if (category === "Closed Positions") {
            const assetId = item[10]?.toString() || "";
            const assetSymbol = assetMapping[assetId] ? assetMapping[assetId].symbol : assetId;
            if (["openPrice", "closePrice", "stopLoss", "takeProfit", "liquidationPrice"].includes(fieldName)) {
              const valWithExpo = applyExpoWithMapping(rawVal.toString(), assetId);
              if ((fieldName === "stopLoss" || fieldName === "takeProfit") && Number(valWithExpo) === 0) {
                displayValue = "Not set";
              } else {
                displayValue = formatPrice(valWithExpo, assetSymbol);
              }
            }
            if (fieldName === "profit") {
              displayValue = profitFormat(Number(displayValue));
            }
          } else if (category === "Limit Orders") {
            const assetId = item[5]?.toString() || "";
            const assetSymbol = assetMapping[assetId] ? assetMapping[assetId].symbol : assetId;
            if (["targetPrice", "stopLoss", "takeProfit"].includes(fieldName)) {
              const valWithExpo = applyExpoWithMapping(rawVal.toString(), assetId);
              if ((fieldName === "stopLoss" || fieldName === "takeProfit") && Number(valWithExpo) === 0) {
                displayValue = "Not set";
              } else {
                displayValue = formatPrice(valWithExpo, assetSymbol);
              }
            }
          }
          html += `<tr>
                     <td>${i}: ${field.type} - ${field.label}</td>
                     <td>${displayValue}</td>
                   </tr>`;
        });
        if (category === "Limit Orders") {
          const rawAssetId = item[5].toString();
          const assetSymbol = assetMapping[rawAssetId] ? assetMapping[rawAssetId].symbol : rawAssetId;
          const currentPrice = (livePrices[rawAssetId] && livePrices[rawAssetId].currentPrice)
                                ? livePrices[rawAssetId].currentPrice
                                : 0;
          const currentPriceFormatted = formatPrice(currentPrice, assetSymbol);
          html += `<tr><td>Current Price (USDC)</td><td>${currentPriceFormatted}</td></tr>`;
          html += `<tr>
                     <td colspan="2">
                       <button onclick="cancelLimitOrder(${item[0]})">Cancel Limit Order</button>
                     </td>
                   </tr>`;
        }
        html += '</table>';
      });
      return html;
    }
  
    function renderOpenPosition(position, stopLoss, takeProfit, liquidationPrice) {
      const id = convertField("id", position[0]);
      const rawAssetId = position[7].toString();
      const assetData = assetMapping[rawAssetId] || { symbol: rawAssetId, expo: 0 };
      const assetName = assetData.symbol;
      const expo = assetData.expo;
      const openPriceConverted = applyExpoWithMapping(position[4].toString(), rawAssetId);
      const stopLossConverted = applyExpoWithMapping(stopLoss.toString(), rawAssetId);
      const takeProfitConverted = applyExpoWithMapping(takeProfit.toString(), rawAssetId);
      const liquidationPriceConverted = applyExpoWithMapping(liquidationPrice.toString(), rawAssetId);
      const openPriceFormatted = formatPrice(openPriceConverted, assetName);
      const currentPriceFormatted = (livePrices[rawAssetId] && livePrices[rawAssetId].currentPrice)
                                    ? formatPrice(livePrices[rawAssetId].currentPrice, assetName)
                                    : formatPrice(0, assetName);
      const stopLossFormatted = Number(stopLossConverted) === 0 ? "Not set" : formatPrice(stopLossConverted, assetName);
      const takeProfitFormatted = Number(takeProfitConverted) === 0 ? "Not set" : formatPrice(takeProfitConverted, assetName);
      const liquidationFormatted = formatPrice(liquidationPriceConverted, assetName);
      const sizeUSDC = Number(ethers.utils.formatUnits(position[3], 6));
      const leverage = Number(position[8].toString());
      const notionalValue = sizeUSDC * leverage;
      const lotSize = notionalValue / openPriceConverted;
      const isShort = position[2];
      const currentPrice = (livePrices[rawAssetId] && livePrices[rawAssetId].currentPrice)
                             ? livePrices[rawAssetId].currentPrice
                             : openPriceConverted;
      const profitUSDC = isShort
                            ? (openPriceConverted - currentPrice) * lotSize
                            : (currentPrice - openPriceConverted) * lotSize;
      const profitPercent = (profitUSDC / notionalValue) * 100;
      
      // Calculate placeholders based on position type
      let takeProfitPlaceholder, stopLossPlaceholder;
      if (!isShort) {
        // Long position: TP at 110% and SL at 90%
        takeProfitPlaceholder = formatPrice(openPriceConverted * 1.10, assetName);
        stopLossPlaceholder = formatPrice(openPriceConverted * 0.90, assetName);
      } else {
        // Short position: TP at 90% and SL at 110%
        takeProfitPlaceholder = formatPrice(openPriceConverted * 0.90, assetName);
        stopLossPlaceholder = formatPrice(openPriceConverted * 1.10, assetName);
      }
      
      // Retrieve any entered values (if they exist)
      const stopLossVal = stopLossInputs[id] || "";
      const takeProfitVal = takeProfitInputs[id] || "";
      
      // Conditional style for position type (displaying "Long" or "Short" with color)
      const isShortHtml = isShort 
                            ? `<span class="price-down">${convertField("isShort", position[2])}</span>`
                            : `<span class="price-up">${convertField("isShort", position[2])}</span>`;
      
      // Conditional style for profit (including percentage within the span)
      const profitUSDCHtml = profitUSDC > 0 
                               ? `<span class="price-up">${usdcFormat(profitUSDC)}</span>`
                               : (profitUSDC < 0 
                                    ? `<span class="price-down">${usdcFormat(profitUSDC)}</span>`
                                    : usdcFormat(profitUSDC));
      const profitPercentHtml = profitPercent > 0 
                                  ? `<span class="price-up">${profitPercent.toFixed(2)} %</span>`
                                  : (profitPercent < 0 
                                       ? `<span class="price-down">${profitPercent.toFixed(2)} %</span>`
                                       : `<span>${profitPercent.toFixed(2)} %</span>`);
      
      let html = `<div class="div-block-499">
        <div class="div-block-507">
          <div class="div-block-514">
            <div class="div-block-523">
              <div class="div-block-517">
                <div class="text-block-253">${assetName}</div>
                <div class="text-block-195">/USDT</div>
              </div>
              <div class="text-block-263">${isShortHtml}</div>
            </div>
          </div>
          <div class="div-block-497">
            <div>
              <div class="text-block-260">Position PNL (USDT)</div>
              <div class="text-block-254">${profitUSDCHtml}</div>
              <div class="text-block-252">
                <strong></strong>
              </div>
            </div>
            <div id="w-node-f5a3995e-64f5-4116-b75b-7e0efaf72c36-1f521c30" class="div-block-528">
              <div class="text-block-246">PNL</div>
              <div class="text-block-248">${profitPercentHtml}</div>
            </div>
            <div>
              <div class="text-block-257">Open Date</div>
              <div class="text-block-268">${convertField("timestamp", position[5])}</div>
            </div>
          </div>
          <div class="div-block-503">
            <div class="div-block-518">
              <div class="text-block-259">Entry Price</div>
              <div class="text-block-265">${openPriceFormatted}</div>
            </div>
            <div class="div-block-530">
              <div class="text-block-264">Liquidation Price</div>
              <div class="text-block-251">${liquidationFormatted}</div>
            </div>
            <div class="div-block-527">
              <div class="text-block-261">Market Price</div>
              <div class="text-block-258">${currentPriceFormatted}</div>
            </div>
          </div>
          <div class="div-block-506">
            <div>
              <div class="text-block-259">Quantity (${assetName})</div>
              <div class="text-block-265">${lotSize.toFixed(8)}</div>
            </div>
            <div>
              <div class="text-block-249">Margin (USDT)</div>
              <div class="text-block-265">${usdcFormat(notionalValue)}</div>
              <div class="text-block-252">
                <strong></strong>
              </div>
            </div>
            <div class="div-block-519">
              <div class="text-block-267">Leverage</div>
              <div class="text-block-265">
                <strong class="bold-text-18">${leverage}</strong>
              </div>
            </div>
          </div>
        </div>
        <div class="div-block-502">
          <div class="div-block-521">
            <div class="div-block-500">
              <div class="text-block-247">Take Profit:</div>
              <div class="text-block-247">${takeProfitFormatted}</div>
            </div>
            <div class="div-block-529">
              <div class="div-block-524">
                <input class="text-field-18 w-input" maxlength="256" name="Set-new-one-3" type="number" id="takeProfitInput-${id}" placeholder="${takeProfitPlaceholder}" data-expo="${expo}"
                  value="${takeProfitVal}" oninput="takeProfitInputs['${id}'] = this.value" onblur="updatePositionsDisplay()" />
                <div class="div-block-508">
                  <a href="#" class="button-113 w-button" onclick="increaseInput('takeProfitInput-${id}', 1)">△</a>
                  <a href="#" class="button-115 w-button" onclick="decreaseInput('takeProfitInput-${id}', 1)">▽</a>
                </div>
              </div>
              <a id="w-node-f5a3995e-64f5-4116-b75b-7e0efaf72c77-1f521c30" href="#" class="button-112 w-button" onclick="updateTakeProfit(${id}, '${rawAssetId}', ${expo})">Set</a>
            </div>
          </div>
          <div class="div-block-521">
            <div class="div-block-500">
              <div class="text-block-247">Stop Loss:</div>
              <div class="text-block-247">${stopLossFormatted}</div>
            </div>
            <div class="div-block-529">
              <div class="div-block-524">
                <input class="text-field-18 w-input" type="number" id="stopLossInput-${id}" placeholder="${stopLossPlaceholder}" data-expo="${expo}"
                  value="${stopLossVal}" oninput="stopLossInputs['${id}'] = this.value" onblur="updatePositionsDisplay()" required />
                <div class="div-block-508">
                  <a href="#" class="button-113 w-button" onclick="increaseInput('stopLossInput-${id}', 1)">△</a>
                  <a href="#" class="button-115 w-button" onclick="decreaseInput('stopLossInput-${id}', 1)">▽</a>
                </div>
              </div>
              <a id="w-node-f5a3995e-64f5-4116-b75b-7e0efaf72c90-1f521c30" href="#" class="button-112 w-button" onclick="updateStopLoss(${id}, '${rawAssetId}', ${expo})">Set</a>
            </div>
          </div>
          <a id="w-node-f5a3995e-64f5-4116-b75b-7e0efaf72c98-1f521c30" href="#" class="button-114 w-button" onclick="closePosition(${id}, '${rawAssetId}')">Close Market</a>
        </div>
      </div>`;
      return html;
    }
  
    /************* INPUT ADJUSTMENT FUNCTIONS *************/
    function increaseInput(inputId, amount) {
      const inputElem = document.getElementById(inputId);
      let currentValue = parseFloat(inputElem.value) || 0;
      inputElem.value = currentValue + amount;
      if (inputId.startsWith("stopLossInput-")) {
        stopLossInputs[inputId.replace("stopLossInput-", "")] = inputElem.value;
      } else if (inputId.startsWith("takeProfitInput-")) {
        takeProfitInputs[inputId.replace("takeProfitInput-", "")] = inputElem.value;
      }
    }
    function decreaseInput(inputId, amount) {
      const inputElem = document.getElementById(inputId);
      let currentValue = parseFloat(inputElem.value) || 0;
      inputElem.value = currentValue - amount;
      if (inputId.startsWith("stopLossInput-")) {
        stopLossInputs[inputId.replace("stopLossInput-", "")] = inputElem.value;
      } else if (inputId.startsWith("takeProfitInput-")) {
        takeProfitInputs[inputId.replace("takeProfitInput-", "")] = inputElem.value;
      }
    }
  
    /************* STREAMING FUNCTION *************/
    function initPriceStream(assetId) {
      if (livePrices[assetId] && livePrices[assetId].eventSource) return;
      const streamUrl = `https://hermes.pyth.network/v2/updates/price/stream?ids[]=${assetId}`;
      const eventSource = new EventSource(streamUrl);
      eventSource.onmessage = (e) => {
        try {
          const data = JSON.parse(e.data);
          const parsed = data.parsed[0];
          livePrices[assetId] = {
            currentPrice: Number(parsed.price.price) * Math.pow(10, parsed.price.expo),
            expo: Number(parsed.price.expo),
            eventSource: eventSource
          };
          updatePositionsDisplay();
        } catch (error) {
          console.error('Error parsing stream for asset', assetId, error);
        }
      };
      eventSource.onerror = (err) => {
        console.error("Error connecting to stream for asset", assetId, err);
      };
      livePrices[assetId] = { currentPrice: 0, expo: 0, eventSource: eventSource };
    }
  
    /************* UPDATE DISPLAY FUNCTION *************/
    function updatePositionsDisplay() {
      if (isUserSelectingText()) return;
      const activeElem = document.activeElement;
      if (activeElem && activeElem.id &&
         (activeElem.id.startsWith("stopLossInput-") || activeElem.id.startsWith("takeProfitInput-"))) {
        return;
      }
      
      // Update dynamic counters
      document.getElementById("openPositionsCount").textContent = cachedOpenPositions.length;
      document.getElementById("closedPositionsCount").textContent = cachedClosedPositions.length;
      document.getElementById("limitOrdersCount").textContent = cachedLimitOrders.length;
      
      // Build display for open positions
      let htmlOpenPositions = "";
      cachedOpenPositions.forEach((position, index) => {
        const rawAssetId = position[7].toString();
        initPriceStream(rawAssetId);
        htmlOpenPositions += renderOpenPosition(
          position,
          cachedStopLosses[index],
          cachedTakeProfits[index],
          cachedLiquidationPrices[index]
        );
      });
  
      // Build display for closed positions
      let htmlClosedPositions = "";
      cachedClosedPositions.forEach((position) => {
        const assetId = position[10].toString();
        const assetData = assetMapping[assetId] || { symbol: assetId, expo: 0 };
        const assetSymbol = assetData.symbol;
        const expo = assetData.expo;
        const openPriceConverted = applyExpoWithMapping(position[4].toString(), assetId);
        const openPriceFormatted = formatPrice(openPriceConverted, assetSymbol);
        const closePriceConverted = applyExpoWithMapping(position[5].toString(), assetId);
        const closePriceFormatted = formatPrice(closePriceConverted, assetSymbol);
        const leverage = Number(position[13].toString());
        const sizeUSDC = Number(ethers.utils.formatUnits(position[3], 6));
        const finalAmount = Number(ethers.utils.formatUnits(position[11], 6));
        const profit = convertField("profit", position[12]);
        const profitPercent = sizeUSDC > 0 ? ((finalAmount - sizeUSDC) / sizeUSDC) * 100 : 0;
        htmlClosedPositions += `<div class="div-block-498">
          <div class="text-block-250">${assetSymbol}/USDT</div>
          <div class="text-block-250">${convertField("isShort", position[2])},</div>
          <div class="text-block-250">${usdcFormat(sizeUSDC)}</div>
          <div class="text-block-250">${openPriceFormatted}</div>
          <div class="text-block-250">${closePriceFormatted}</div>
          <div class="text-block-250">
            <strong class="bold-text-18">×${leverage}</strong>
          </div>
          <div id="w-node-f5a3995e-64f5-4116-b75b-7e0efaf72cb8-1f521c30" class="text-block-250">
            ${profit} (${profitPercent.toFixed(2)}%)
          </div>
        </div>`;
      });
  
      // Build display for limit orders
      let htmlLimitOrders = "";
      cachedLimitOrders.forEach((order) => {
        const assetId = order[5].toString();
        const assetData = assetMapping[assetId] || { symbol: assetId, expo: 0 };
        const assetSymbol = assetData.symbol;
        const targetPriceConverted = applyExpoWithMapping(order[6].toString(), assetId);
        const targetPriceFormatted = formatPrice(targetPriceConverted, assetSymbol);
        const currentPriceFormattedOrder = (livePrices[assetId] && livePrices[assetId].currentPrice)
          ? formatPrice(livePrices[assetId].currentPrice, assetSymbol)
          : formatPrice(0, assetSymbol);
        const sizeUSDC = Number(ethers.utils.formatUnits(order[3], 6));
        const leverage = order[4].toString();
      
        htmlLimitOrders += `
          <div class="div-block-513">
            <div class="ordertext">${assetSymbol}/USD</div>
            <div class="ordertext">${convertField("isShort", order[2])}</div>
            <div class="ordertext">${targetPriceFormatted}</div>
            <div class="ordertext">${currentPriceFormattedOrder}</div>
            <div class="ordertext">${usdcFormat(sizeUSDC)}</div>
            <div class="ordertext">${order[0].toString()}</div>
            <div class="ordertext">${leverage}</div>
            <a href="#" class="button-110 w-button" onclick="cancelLimitOrder(${order[0]})">
              Cancel Order
            </a>
          </div>
        `;
      });
  
      // Inject HTML into corresponding containers
      document.getElementById("openPositionsContainer").innerHTML = htmlOpenPositions;
      document.getElementById("closedPositionsContainer").innerHTML = htmlClosedPositions;
      document.getElementById("limitOrdersContainer").innerHTML = htmlLimitOrders;
    }
  
    /************* CONTRACT INTERACTIONS *************/
    async function connect() {
      if (typeof window.ethereum !== 'undefined') {
        try {
          await ethereum.request({ method: 'eth_requestAccounts' });
          provider = new ethers.providers.Web3Provider(window.ethereum);
          signer = provider.getSigner();
          const address = await signer.getAddress();
          document.getElementById('wallet-address').innerText = address;
          contract = new ethers.Contract(contractAddress, contractABI, signer);
          contract.on("PositionOpened", () => { fetchPositions(); });
          contract.on("PositionClosed", () => { fetchPositions(); });
          contract.on("LimitOrderCanceled", () => { fetchPositions(); });
          contract.on("LimitOrderExecuted", () => { fetchPositions(); });
          fetchPositions();
        } catch (error) {
          console.error("Error during connection:", error);
        }
      } else {
        showNotification("MetaMask is not installed. Please install it and try again.");
      }
    }
  
    async function fetchPositions() {
      if (!contract) {
        showNotification("Please connect your wallet first.");
        return;
      }
      try {
        const traderAddress = await signer.getAddress();
        const ids = await contract.getTraderAllIds(traderAddress);
        const openPositionIds = ids[0];
        const closedPositionIds = ids[1];
        const limitOrderIds = ids[2];
  
        const openPositions = await Promise.all(
          openPositionIds.map(id => contract.positions(id))
        );
        const closedPositions = await Promise.all(
          closedPositionIds.map(id => contract.closedPositions(id))
        );
        const limitOrders = await Promise.all(
          limitOrderIds.map(id => contract.limitOrders(id))
        );
        const stopLosses = await Promise.all(
          openPositionIds.map(id => contract.stopLosses(id))
        );
        const takeProfits = await Promise.all(
          openPositionIds.map(id => contract.takeProfits(id))
        );
        const liquidationPrices = await Promise.all(
          openPositionIds.map(id => contract.liquidationPrices(id))
        );
  
        cachedOpenPositions = openPositions;
        cachedStopLosses = stopLosses;
        cachedTakeProfits = takeProfits;
        cachedLiquidationPrices = liquidationPrices;
        cachedClosedPositions = closedPositions;
        cachedLimitOrders = limitOrders;
  
        openPositions.forEach(position => {
          const rawAssetId = position[7].toString();
          initPriceStream(rawAssetId);
        });
        limitOrders.forEach(order => {
          const rawAssetId = order[5].toString();
          initPriceStream(rawAssetId);
        });
  
        updatePositionsDisplay();
      } catch (error) {
        console.error("Error fetching positions:", error);
      }
    }
  
    async function updateStopLoss(positionId, assetId, expo) {
      const inputElem = document.getElementById(`stopLossInput-${positionId}`);
      const userValue = Number(inputElem.value);
      const newStopLoss = userValue * Math.pow(10, -expo);
      try {
        const tx = await contract.updateStopLoss(positionId, newStopLoss);
        await tx.wait();
        showNotification(`Stop Loss for position ${positionId} updated successfully.`);
        fetchPositions();
      } catch (error) {
        console.error("Error updating Stop Loss:", error);
      }
    }
  
    async function updateTakeProfit(positionId, assetId, expo) {
      const inputElem = document.getElementById(`takeProfitInput-${positionId}`);
      const userValue = Number(inputElem.value);
      const newTakeProfit = userValue * Math.pow(10, -expo);
      try {
        const tx = await contract.updateTakeProfit(positionId, newTakeProfit);
        await tx.wait();
        showNotification(`Take Profit for position ${positionId} updated successfully.`);
        fetchPositions();
      } catch (error) {
        console.error("Error updating Take Profit:", error);
      }
    }
  
    async function closePosition(positionId, assetId) {
      try {
        const response = await fetch(`https://hermes.pyth.network/v2/updates/price/latest?ids[]=${assetId}`);
        const json = await response.json();
        let priceUpdateHex = json.binary.data[0];
        if (!priceUpdateHex.startsWith("0x")) {
          priceUpdateHex = "0x" + priceUpdateHex;
        }
        const priceUpdateArray = [priceUpdateHex];
        const tx = await contract.closePosition(positionId, priceUpdateArray, { value: 0 });
        await tx.wait();
        showNotification(`Position ${positionId} closed successfully.`);
        fetchPositions();
      } catch (error) {
        console.error("Error closing position:", error);
      }
    }
  
    async function cancelLimitOrder(orderId) {
      try {
        const tx = await contract.cancelLimitOrder(orderId);
        await tx.wait();
        showNotification(`Limit order ${orderId} cancelled successfully.`);
        fetchPositions();
      } catch (error) {
        console.error("Error cancelling limit order:", error);
      }
    }
  
    document.addEventListener("DOMContentLoaded", () => {
      updatePositionsDisplay();
    });
  </script>
  
      
    <style>
  .price-up { 
      color: #2a8bff; /* Vert */
  }
  .price-down { 
      color: #dc3545; /* Rouge */
  }
  .price-neutral { 
      color: #6c757d; /* Gris */
      
  }

  
    .watermark {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: rgba(255, 255, 255, 0.1);
      font-size: 12px;
      font-family: 'Source Code Pro', monospace;
      pointer-events: none;
      z-index: 0;
    }

    .div-block-496 {
    padding-left: 7px;
    padding-top: 7px;
}
#notification {
      position: fixed; top: 10px; left: 50%;
      transform: translateX(-50%);
      background-color: #000000; color: white;
      padding: 10px 20px; http://192.168.1.42:8080/#
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
      display: none; z-index: 1000;
    }
    /* Cacher les flèches +/- dans les inputs de type number */
input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

input[type=number] {
  -moz-appearance: textfield; /* Firefox */
}

/* Cacher les scrollbars (mais permettre le scroll) */
::-webkit-scrollbar {
  width: 0px;
  background: transparent; /* facultatif */
}

body {
  scrollbar-width: none; /* Firefox */
  -ms-overflow-style: none; /* Internet Explorer 10+ */
}

  </style>
  <script>
    (function(){
      // Gestion de la connexion/déconnexion via les divs .connect et .disconnect
  
      // On considère initialement que l'utilisateur n'est pas connecté
      let walletConnected = false;
  
      // Met à jour l'UI en fonction de l'état de connexion
      function updateConnectionUI(isConnected) {
        const connectDiv = document.querySelector('.connect');
        const disconnectDiv = document.querySelector('.disconnect');
        if (isConnected) {
          if (connectDiv) connectDiv.style.display = 'none';
          if (disconnectDiv) disconnectDiv.style.display = 'block';
        } else {
          if (connectDiv) connectDiv.style.display = 'block';
          if (disconnectDiv) disconnectDiv.style.display = 'none';
        }
      }
  
      // Fonction pour connecter : appelle vos deux fonctions connect() et connectWallet()
      function handleConnect() {
        if (typeof connect === "function") {
          connect();
        }
        if (typeof connectWallet === "function") {
          connectWallet();
        }
        walletConnected = true;
        updateConnectionUI(true);
      }
  
      // Fonction pour "déconnecter" : ici on simule la déconnexion en réinitialisant nos variables d'état
      function handleDisconnect() {
        // Ici, on appelle la fonction disconnectWallet si elle existe
        if (typeof disconnectWallet === "function") {
          disconnectWallet();
        } else {
          console.warn("disconnectWallet n'est pas défini. On réinitialise simplement l'état.");
        }
        walletConnected = false;
        // Réinitialisation de nos variables internes
        signer = null;
        contract = null;
        document.getElementById('walletAddress').textContent = "Please Connect your Wallet";
        updateConnectionUI(false);
      }
  
      document.addEventListener('DOMContentLoaded', function(){
        // Attacher l'événement sur l'élément de connexion
        const connectDiv = document.querySelector('.connect');
        if (connectDiv) {
          connectDiv.addEventListener('click', function(e){
            e.preventDefault();
            handleConnect();
          });
        }
        // Attacher l'événement sur l'élément de déconnexion
        const disconnectDiv = document.querySelector('.disconnect');
        if (disconnectDiv) {
          disconnectDiv.addEventListener('click', function(e){
            e.preventDefault();
            handleDisconnect();
          });
        }
        // Mise à jour initiale de l'interface
        updateConnectionUI(false);
      });
  
      // Exposition éventuelle des fonctions
      window.customConnectionManager = {
        connect: handleConnect,
        disconnect: handleDisconnect,
        updateUI: updateConnectionUI
      };
    })();
  </script>
  <script>
    const targetDiv = document.getElementById("w-node-_655bec7b-eaf2-c952-5d89-dbca9e08e6d8-1f521c30");

targetDiv.addEventListener("click", () => {
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen().catch(err => {
      console.error(`Erreur lors du passage en plein écran: ${err.message}`);
    });
  } else {
    document.exitFullscreen().catch(err => {
      console.error(`Erreur lors de la sortie du plein écran: ${err.message}`);
    });
  }
});


  </script>
     <script>
        // Variables
        const testFileUrl = 'https://httpbin.org/bytes/1048576'; // Fichier de 1MB
        const testIntervalTime = 60000; // 60 secondes

        // Mesure de latence
        async function measureLatency() {
            try {
                const start = performance.now();
                await fetch('https://httpbin.org/get', {method: 'HEAD', cache: 'no-store'});
                const latency = Math.round(performance.now() - start);
                
                document.getElementById('latency1').textContent = `Latence 1: ${latency} ms`;
                document.getElementById('latency2').textContent = `Latence 2: ${latency} ms`;
                
                return latency;
            } catch (error) {
                document.getElementById('latency1').textContent = 'Erreur latence';
                document.getElementById('latency2').textContent = 'Erreur latence';
                return null;
            }
        }

        // Mesure de débit
        async function measureSpeed() {
            try {
                const start = performance.now();
                const response = await fetch(testFileUrl + '?r=' + Math.random(), {cache: 'no-store'});
                const totalBytes = parseInt(response.headers.get('content-length') || '1048576');
                await response.arrayBuffer();
                const duration = (performance.now() - start) / 1000;
                const speedMbps = ((totalBytes * 8) / (1024 * 1024)) / duration;
                
                document.getElementById('speed1').textContent = `Débit 1: ${speedMbps.toFixed(2)} Mbps`;
                document.getElementById('speed2').textContent = `Débit 2: ${speedMbps.toFixed(2)} Mbps`;
                
                return speedMbps;
            } catch (error) {
                document.getElementById('speed1').textContent = 'Erreur débit';
                document.getElementById('speed2').textContent = 'Erreur débit';
                return null;
            }
        }

        // Compte à rebours
        function startCountdown(seconds) {
            let counter = seconds;
            const countdownElement = document.getElementById('countdown');
            
            const interval = setInterval(() => {
                counter--;
                countdownElement.textContent = counter;
                
                if (counter <= 0) {
                    clearInterval(interval);
                    runTests();
                }
            }, 1000);
        }

        // Exécuter tous les tests
        async function runTests() {
            document.getElementById('countdown').textContent = "60";
            await measureLatency();
            await measureSpeed();
            startCountdown(60);
        }

        // Démarrer au chargement
        window.onload = runTests;
    </script>
     <script>
        async function runTest() {
          const testImageUrl = "https://upload.wikimedia.org/wikipedia/commons/3/3f/JPEG_example_flower.jpg";
          const testImageSize = 30839; // File size in bytes (31 KB)
    
          // Latency test
          try {
            const latencyStart = performance.now();
            await fetch(testImageUrl, { method: "HEAD" });
            const latencyEnd = performance.now();
            const latency = latencyEnd - latencyStart;
            document.querySelectorAll("#latency-result").forEach(el => {
              el.textContent = `${latency.toFixed(2)}`;
            });
          } catch (error) {
            document.querySelectorAll("#latency-result").forEach(el => {
              el.textContent = "Test error";
            });
          }
    
          // Download speed test
          try {
            const downloadStart = performance.now();
            const response = await fetch(testImageUrl);
            await response.blob();
            const downloadEnd = performance.now();
    
            const durationInSeconds = (downloadEnd - downloadStart) / 1000;
            const speedMbps = (testImageSize * 8) / (durationInSeconds * 1000000);
    
            document.querySelectorAll("#speed-result").forEach(el => {
              el.textContent = `${speedMbps.toFixed(2)}`;
            });
          } catch (error) {
            document.querySelectorAll("#speed-result").forEach(el => {
              el.textContent = "Test error";
            });
          }
        }
    
        window.onload = runTest;
      </script>
  
  
  </body>
</html>
